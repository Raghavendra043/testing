"use strict";(self.webpackChunkopentele_client_html_angular=self.webpackChunkopentele_client_html_angular||[]).push([[865],{8858:(x,I,e)=>{e.d(I,{T:()=>R});var p=e(5861),P=e(520),b=e(2826),F=e(9808),T=e(5e3),u=e(7362),U=e(4679);let R=(()=>{class n{constructor(m,N,f){var y=this;this.native=m,this.util=N,this.http=f,this.clearPushNotificationRegistrationState=()=>{this.registrationPromise=void 0},this.registerDeviceForPushNotifications=E=>new Promise((O,d)=>{this.native.getDeviceToken(({deviceToken:o,deviceOS:c})=>this.registerDevice(E,o,c).then(()=>{console.debug(`Device with token: '${o}' successfully registered for push notifications`),O()}).catch(()=>{console.error(`Failed to register device token: ${o} for push notifications`)}))||console.debug("Couldn't request device token")}),this.ensureDeviceRegisteredForPushNotifications=E=>this.registrationPromise?this.registrationPromise.then(()=>!0,()=>!1):this.registerDeviceForPushNotifications(E),this.registerDevice=function(){var E=(0,p.Z)(function*(L,O,d){var s,o;if(!y.util.exists(null===(s=L.links)||void 0===s?void 0:s.notifications)||!y.util.exists(null===(o=L.links)||void 0===o?void 0:o.self))throw new TypeError("User object is missing a link to either 'patient' or 'notifications'");const c=(new P.qT).set(b.Hq,!0).set(b.SF,!0),C=L.links.self,i=L.links.notifications,k=i+"?patientUrl="+C,l=(yield(0,F.n)(y.http.get(k,{context:c}))).results.find(({patientUrl:v})=>v===C);return y.util.exists(l)&&y.util.exists(l.links)&&y.util.exists(l.links.device)?(0,F.n)(y.http.put(l.links.device,{patientUrl:l.patientUrl,deviceToken:O,deviceOS:d},{context:c})):(0,F.n)(y.http.post(i,{patientUrl:C,deviceToken:O,deviceOS:d}))});return function(L,O,d){return E.apply(this,arguments)}}()}}return n.\u0275fac=function(m){return new(m||n)(T.LFG(u.R),T.LFG(U.c),T.LFG(P.eN))},n.\u0275prov=T.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},2279:(x,I,e)=>{e.d(I,{e:()=>u});var p=e(520),P=e(9808),b=e(2826),F=e(5e3),T=e(4679);let u=(()=>{class U{constructor(n,g){this.util=n,this.http=g}currentPatient(n){var g;const m=null===(g=null==n?void 0:n.links)||void 0===g?void 0:g.patient;if(!this.util.exists(m))throw new TypeError("Root object does not contain a link relation to patient");return(0,P.n)(this.http.get(m))}getSelf(n){var g;const m=null===(g=null==n?void 0:n.links)||void 0===g?void 0:g.self;if(!this.util.exists(m))throw new TypeError("Patient object does not contain a link relation to self");return(0,P.n)(this.http.get(m))}find(n,g){if(!n.hasOwnProperty("links")||!n.links.hasOwnProperty("patients"))throw new TypeError("User object does not contain a link relation to patients");return(0,P.n)(this.http.get(n.links.patients,{params:g,context:(new p.qT).set(b.Hq,!0)}))}create(n,g){if(!n.hasOwnProperty("links")||!n.links.hasOwnProperty("patients"))throw new TypeError("User object does not contain a link relation to patients");console.debug(JSON.stringify(g));const m={context:(new p.qT).set(b.Hq,!0)};return(0,P.n)(this.http.post(n.links.patients,g,m))}get(n,g){if(!n.hasOwnProperty("links")||!n.links.hasOwnProperty("patients"))throw new TypeError("User object does not contain a link relation to patients");return(0,P.n)(this.http.get(g.links.patient))}}return U.\u0275fac=function(n){return new(n||U)(F.LFG(T.c),F.LFG(p.eN))},U.\u0275prov=F.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()},4865:(x,I,e)=>{e.d(I,{o:()=>C});var p=e(5861),P=e(3175),b=e(4815),F=e(9808),T=e(2843),u=e(5e3),U=e(4879),R=e(4338),n=e(520),g=e(2826),m=e(1480),N=e(8351);let f=(()=>{class i{constructor(r,l){this.http=r,this.config=l}get(){const r=(0,m.E)(this.config.getAppConfig().baseUrl,"clinician/api/"),l=(new n.qT).set(g.Hq,!0);return this.http.get(r,{context:l})}}return i.\u0275fac=function(r){return new(r||i)(u.LFG(n.eN),u.LFG(N.E))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var y=e(2279),E=e(619),L=e(1866),O=e(8858),d=(()=>{return(i=d||(d={})).DEBUG="debug",i.INFO="debug",i.WARN="debug",i.ERROR="error",d;var i})(),s=e(7362);let o=(()=>{class i{constructor(r,l){this.http=r,this.nativeService=l,this.logUrl=void 0,this.enable=v=>{var t;null===(t=this.originalConsole)||void 0===t||t.debug("Enable client logging"),this.logUrl=v,this.subscribeToNativeLogEntries(),this.overrideConsoleLogFunctions()},this.subscribeToNativeLogEntries=()=>{this.nativeService.enableClientLogging(v=>{this.submitLogEntriesToBackend(v.entries)})},this.overrideConsoleLogFunctions=()=>{const v=(t,a)=>{const S=(new Date).toISOString();this.submitLogEntriesToBackend([{level:a,message:t,timestamp:S}])};globalThis.console.log=t=>{var a;null===(a=this.originalConsole)||void 0===a||a.log(t),v(t,d.DEBUG)},globalThis.console.debug=t=>{var a;null===(a=this.originalConsole)||void 0===a||a.debug(t),v(t,d.DEBUG)},globalThis.console.info=t=>{var a;null===(a=this.originalConsole)||void 0===a||a.info(t),v(t,d.INFO)},globalThis.console.warn=t=>{var a;null===(a=this.originalConsole)||void 0===a||a.warn(t),v(t,d.WARN)},globalThis.console.error=t=>{var a;null===(a=this.originalConsole)||void 0===a||a.error(t),v(t,d.ERROR)}},this.submitLogEntriesToBackend=v=>{var t,a;const S=(new n.qT).set(g.SF,!0).set(g.Hq,!0);try{(0,F.n)(this.http.post(this.logUrl,v,{context:S})),null===(t=this.originalConsole)||void 0===t||t.debug("Log entries submitted to backend")}catch(h){h instanceof n.UA||JSON.stringify(h),null===(a=this.originalConsole)||void 0===a||a.error("Failed to send log entries to backend")}},void 0!==globalThis.console?this.originalConsole={log:globalThis.console.log,debug:globalThis.console.debug,info:globalThis.console.info,warn:globalThis.console.warn,error:globalThis.console.error}:console.error("Could not find globalThis.console!")}}return i.\u0275fac=function(r){return new(r||i)(u.LFG(n.eN),u.LFG(s.R))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var c=e(211);let C=(()=>{class i{constructor(r,l,v,t,a,S,h,A,G,D){this.authentication=r,this.appContext=l,this.serverInfo=v,this.patientService=t,this.router=a,this.videoFacade=S,this.notifications=h,this.clientLoggingService=A,this.clinicianService=G,this.configService=D,this.jwtHelper=new P.N0,this.enableClientLogging=j=>{j.links.logEntries?this.clientLoggingService.enable(j.links.logEntries):console.info("Client logging not enabled.")}}init(){return console.debug("Init new user session."),this.authentication.clearCurrentAuthToken(),this.appContext.currentUser.clear(),this.appContext.requestParams.clear(),this.notifications.clearPushNotificationRegistrationState(),(0,F.n)(this.serverInfo.get())}startSilentLogin(r,l){return this.authentication.trySilentLogin(r.links.auth).subscribe({next:t=>{if("data"in t)return l(t);const{claims:a,canChangePassword:S,logoutUrl:h,organizations:A}=t;return this.completeLogin(r,a,S,h,A)},error:l})}completeLogin(r,l,v,t,a){var S=this;return(0,p.Z)(function*(){let h;S.clinicianService.setIsClinician("patient"!==l.uty);const A=S.clinicianService.isClinician();b.V$.delete();const D=S.configService.getAppConfig().appType;switch(D){case"clinicianApp":A?h=yield S.clinicianService.currentClinician(r):(console.error("AppType is 'Clinician' and user is not a clinician"),b.V$.set("APP_TYPE_CLINICIAN"));break;case"clinicianAndPatientApp":h=A?yield S.clinicianService.currentClinician(r):yield S.patientService.currentPatient(r);break;case"patientApp":A?(console.error("AppType is 'Patient' and user is not a patient"),b.V$.set("APP_TYPE_PATIENT")):h=yield S.patientService.currentPatient(r);break;default:h=void 0,console.error(`Unknown app type: ${D}`)}return void 0===h?(console.error("User is undefined"),(0,T._)({})):(h.claims=l,h.canChangePassword=v,h.links.auth=r.links.auth,h.organizations=a,t&&(h.links.logout=t),S.appContext.currentUser.set(h),S.enableClientLogging(h),h.links&&h.links.individualSessions&&S.videoFacade.listenForIncomingCall(h.links.individualSessions),S.router.navigate(A?["/clinician_menu"]:["/menu"]))})()}setPatientUser(r,l){var v;const t=structuredClone(r);t.claims=this.jwtHelper.decodeToken(l.token),t.canChangePassword=!1;const a=this.appContext.currentUser.get();return t.links.auth=a.links.auth,t.organizations=l.customClaims.organizations,!(null===(v=null==l?void 0:l.links)||void 0===v)&&v.logout&&(t.links.logout=l.links.logout),t.links&&t.links.individualSessions&&this.videoFacade.listenForIncomingCall(t.links.individualSessions),this.enableClientLogging(t),t}}return i.\u0275fac=function(r){return new(r||i)(u.LFG(U.$),u.LFG(R.P),u.LFG(f),u.LFG(y.e),u.LFG(E.F0),u.LFG(L.k),u.LFG(O.T),u.LFG(o),u.LFG(c.N),u.LFG(N.E))},i.\u0275prov=u.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},1866:(x,I,e)=>{e.d(I,{k:()=>N});var p=e(5e3),P=e(5861),b=e(60),F=e(520),T=e(9808),u=e(2826),U=e(4338),R=e(619);let n=(()=>{class f{constructor(E,L,O,d){var s=this;this.http=E,this.appContext=L,this.router=O,this.ngZone=d,this.constants=Object.freeze({roomCredentials:"roomCredentials",sessionUrl:"individualSessionUrl",joinConferencePath:"joinConference",loginPath:"login",authenticationError:"authenticationError"}),this.joinSession=function(){var o=(0,P.Z)(function*(c){const C=(new F.qT).set(u.SF,!0).set(u.Hq,!0);console.debug("Joining conference"),console.debug("Individual session:",JSON.stringify(c));const i=c.links.individualSession,k=b.Ye.joinWithSlash(i,"participant");try{const r={present:!0},l=yield(0,T.n)(s.http.put(k,r,{context:C}));console.debug("Room status:",JSON.stringify(l)),s.appContext.requestParams.set(s.constants.roomCredentials,l.roomCredentials),s.appContext.requestParams.set(s.constants.sessionUrl,i),s.ngZone.run(()=>{console.debug("Redirecting to join conference component"),s.router.navigate([s.constants.joinConferencePath])})}catch(r){const l=r instanceof F.UA?`Status: ${r.status}`:JSON.stringify(r);console.error("Could not join session %s. %s",c,l)}});return function(c){return o.apply(this,arguments)}}(),this.leaveSession=function(){var o=(0,P.Z)(function*(c){console.debug("Leaving individual session");const C=(new F.qT).set(u.SF,!0).set(u.Hq,!0);console.debug(`Individual sessions URL: ${c}`);const i=b.Ye.joinWithSlash(c,"participant"),k={present:!1};try{yield(0,T.n)(s.http.put(i,k,{context:C})),console.debug("Succesfully left individual session")}catch(r){console.debug("Failed to leave individual session"),console.debug(`Status: ${r}`)}});return function(c){return o.apply(this,arguments)}}(),this.checkForSession=function(){var o=(0,P.Z)(function*(c){const C=new URL(c);C.searchParams.set("status","open");const i=(new F.qT).set(u.SF,!0).set(u.Hq,!0);try{return(0,T.n)(s.http.get(C.toString(),{context:i}))}catch(k){return console.error(`Error occurred trying to check for pending individual sessions: ${k}`),Promise.resolve(void 0)}});return function(c){return o.apply(this,arguments)}}(),this.checkForSessionAndJoin=function(){var o=(0,P.Z)(function*(c){const C=yield s.checkForSession(c);void 0!==C&&C.results.length>0&&s.joinSession(C.results[0])});return function(c){return o.apply(this,arguments)}}(),this.isHostPresent=o=>{const c=(new F.qT).set(u.SF,!0).set(u.Hq,!0);return(0,T.n)(this.http.get(o,{context:c}))}}}return f.\u0275fac=function(E){return new(E||f)(p.LFG(F.eN),p.LFG(U.P),p.LFG(R.F0),p.LFG(p.R0b))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})();var g=e(7362);let m=(()=>{class f{constructor(E,L,O){this.native=E,this.individualSessionsApi=L,this.router=O,this.texts=Object.freeze({conferenceStarted:"CONFERENCE_STARTED",conferenceEnded:"CONFERENCE_ENDED",conferenceError:"CONFERENCE_ERROR"}),this.constants=Object.freeze({status:"status",info:"info",error:"error",timeoutInMillis:3e3,menuPath:"/menu",videoConferenceResponse:"videoConferenceResponse",incomingVideoCall:"incomingVideoCall"}),this.states=Object.freeze({prompted:"prompted",joining:"joining",joined:"joined",disconnected:"disconnected"}),this.listenForNativeEvent=(d,s)=>{this.native.subscribeToMultipleMessages(this.constants.videoConferenceResponse,c=>{this.handleEvent(d,s,c.event)})},this.listenForIncomingCall=d=>{this.native.unsubscribeAll(this.constants.incomingVideoCall),this.native.subscribeToMultipleMessages(this.constants.incomingVideoCall,()=>{console.debug("received 'incomingVideoCall' message"),this.individualSessionsApi.checkForSessionAndJoin(d)})},this.handleEvent=(d,s,o)=>{console.debug(`Event: ${JSON.stringify(o)}`);const c=o.type;c===this.constants.status?this.handleStatusEvent(d,s,o):console.warn(`Unknown event type: ${c}`)},this.handleStatusEvent=(d,s,o)=>{const c=o.status,C=c.type,i=c.message;switch(C){case this.constants.error:this.handleErrorEvent(d,s,i);break;case this.constants.info:this.handleInfoEvent(d,s,i);break;default:console.warn(`Unknown status type: ${C}`)}},this.handleErrorEvent=(d,s,o)=>{s.state=this.states.disconnected,o===this.texts.conferenceError?this.endSession(d):s.error=o},this.handleInfoEvent=(d,s,o)=>{switch(s.message=o,o){case this.texts.conferenceStarted:console.debug("Conference started"),s.state=this.states.joined;break;case this.texts.conferenceEnded:s.state=this.states.disconnected,this.endSession(d);break;default:console.debug(`Info message received: ${JSON.stringify(o)}`),s.info=o}},this.endSession=d=>{console.debug("CONFERENCE ENDED"),this.individualSessionsApi.leaveSession(d),this.native.leaveConference()||console.debug("Couldn't leave conference"),this.native.unsubscribeAll(this.constants.videoConferenceResponse),this.router.navigate([this.constants.menuPath])}}}return f.\u0275fac=function(E){return new(E||f)(p.LFG(g.R),p.LFG(n),p.LFG(R.F0))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})(),N=(()=>{class f{constructor(E,L){this.individualSessionsApi=E,this.videoListener=L,this.checkForSessionAndJoin=this.individualSessionsApi.checkForSessionAndJoin,this.leaveSession=this.individualSessionsApi.leaveSession,this.isHostPresent=this.individualSessionsApi.isHostPresent,this.sessionEnded=this.videoListener.endSession,this.listenForNativeEvent=this.videoListener.listenForNativeEvent,this.listenForIncomingCall=this.videoListener.listenForIncomingCall}}return f.\u0275fac=function(E){return new(E||f)(p.LFG(n),p.LFG(m))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},1480:(x,I,e)=>{e.d(I,{E:()=>p});const p=(P,b)=>P+b}}]);