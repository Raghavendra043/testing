"use strict";(self.webpackChunkopentele_client_html_angular=self.webpackChunkopentele_client_html_angular||[]).push([[657],{657:(Le,oe,O)=>{O.r(oe),O.d(oe,{QuestionnairesModule:()=>bn});var I=O(60),w=O(619),Y=O(5861),e=O(5e3),a=O(3075),K=O(4338),M=O(1786),F=O(520),L=O(2826),b=O(9808),j=O(4679),ce=O(211);let ie=(()=>{class n{constructor(t,o,i,s){this.util=t,this.clinicianService=o,this.appContext=i,this.http=s}list(t,o){if(this.util.exists(t.links.questionnaires))return(0,b.n)(o?this.http.get(t.links.questionnaires,{params:o,context:(new F.qT).set(L.Hq,!0)}):this.http.get(t.links.questionnaires));throw new TypeError("User object does not contain a link relation to questionnaires")}get(t){if(this.util.hasNestedProperty(t,"links.questionnaire"))return(0,b.n)(this.http.get(t.links.questionnaire));throw new TypeError("Questionnaire ref does not contain a link relation to questionnaire details")}getHelpImage({imageUrl:t}){return(0,b.n)(this.http.get(t,{responseType:"text",context:(new F.qT).set(L.Hq,!0).set(L.SF,!0)}))}replyTo(t,o){const i=this.clinicianService.isClinician(),s={version:t.version,output:o,date:(new Date).toISOString()};if(i){console.debug("Posting questionnaire as clinician");const d=this.appContext.getUser();s.links={patient:d.links.self}}console.debug(`POST questionnaire data: ${JSON.stringify(s)}`);const l={context:(new F.qT).set(L.Hq,!0)};return(0,b.n)(this.http.post(t.links.questionnaireResult,s,l))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.c),e.LFG(ce.N),e.LFG(K.P),e.LFG(F.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var be=O(1480),Ze=O(8351);let we=(()=>{class n{constructor(t,o){this.http=t,this.configService=o,this.appConfig=this.configService.getAppConfig()}list(t){const o=(0,be.E)(this.appConfig.baseUrl,"questionnaires/questionnaire-groups");return(0,b.n)(t?this.http.get(o,{params:t,context:(new F.qT).set(L.Hq,!0)}):this.http.get(o))}getQuestionnaires(t,o){var i=this;return(0,Y.Z)(function*(){var s;const l=[],u=[];try{const d=yield(0,b.n)(i.http.get(t,{params:o,context:(new F.qT).set(L.Hq,!0)}));for(const m of d.questionnaires){const p=yield(0,b.n)(i.http.get(m,{params:o,context:(new F.qT).set(L.Hq,!0).set(L.SF,!0)}));null!==(s=null==p?void 0:p.links)&&void 0!==s&&s.activeQuestionnaire&&l.push(p.links.activeQuestionnaire)}for(const m of l){const p=yield(0,b.n)(i.http.get(m,{params:o,context:(new F.qT).set(L.Hq,!0).set(L.SF,!0)})),c=p.links.questionnaireResult.substring(0,p.links.questionnaireResult.lastIndexOf("/"));p.links.questionnaire=c,u.push(p)}return u}catch(d){throw new Error(`Failed due to: ${d}`)}})()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(F.eN),e.LFG(Ze.E))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var X=O(8507),Ne=O(3056);function Fe(n,r){1&n&&(e.TgZ(0,"div",20),e._UZ(1,"i",21),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"QUESTIONNAIRES_LOADING")," "))}function qe(n,r){1&n&&(e.TgZ(0,"div",22),e._UZ(1,"i",23),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"QUESTIONNAIRES_FAILED")," "))}function ke(n,r){1&n&&e._UZ(0,"i",24)}function Ve(n,r){1&n&&e._UZ(0,"i",25)}const Pe=function(n){return{count:n}};function Be(n,r){if(1&n&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,"OTHER_QUESTIONNAIRES_FOUND_QUESTIONNAIRES",e.VKq(4,Pe,null==t.model.questionnaires?null:t.model.questionnaires.length))," ")}}function Qe(n,r){1&n&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"OTHER_QUESTIONNAIRES_START_SEARCHING_QUESTIONNAIRES")," "))}function Ge(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",26),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.chooseQuestionnaire(s))}),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&n){const t=r.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.AsE(" ",e.lcZ(5,3,"OTHER_QUESTIONNAIRES_VERSION"),": ",t.version," ")}}let Je=(()=>{class n{constructor(t,o,i,s,l,u,d,m,p){var c;this.formBuilder=t,this.appContext=o,this.translate=i,this.questionnaires=s,this.questionnaireGroupsService=l,this.router=u,this.utils=d,this.translateService=m,this.elementRef=p,this.model={state:"Initial",questionnaires:void 0},this.searchQuestionnairesForm=this.formBuilder.group({questionnaireGroups:[""]}),this.questionnaireGroupList=[],this.dropdownSettings={singleSelection:!1,idField:"link",textField:"name",searchPlaceholderText:this.translate.instant("SEARCH"),noDataAvailablePlaceholderText:this.translate.instant("NO_DATA_AVAILABLE"),enableCheckAll:!1,allowSearchFilter:!0},this.title="",this.searchText="",this.appContext.requestParams.set("useDefaultAuth",!0),this.user=this.appContext.currentUser.get();const h=this.appContext.getUser();this.title=`${h.firstName} ${h.lastName}`,this.searchText=m.instant("SEARCH_ALL"),null===(c=this.searchQuestionnairesForm.get("questionnaireGroups"))||void 0===c||c.valueChanges.subscribe(f=>{this.searchText=this.translateService.instant((null==f?void 0:f.length)>0?"SEARCH":"SEARCH_ALL")})}ngOnInit(){var t=this;return(0,Y.Z)(function*(){yield t.renderQuestionnaireGroups()})()}renderQuestionnaireGroups(){var t=this;return(0,Y.Z)(function*(){const o={max:1e4};try{const s=(yield t.questionnaireGroupsService.list(o)).results,l=[];for(const u of s)l.push({name:u.name,link:u.links.questionnaireGroup});t.questionnaireGroupList=l}catch(i){t.model.state="Failed",console.error(`Failed to fetch questionnaireGroups due to error: ${i}`)}})()}search(){var t=this;return(0,Y.Z)(function*(){t.model.state="Loading",t.model.questionnaires=[];const o={max:1e4},i=t.searchQuestionnairesForm.value.questionnaireGroups;try{if((null==i?void 0:i.length)>0){let s=[];for(const l of i){const u=yield t.questionnaireGroupsService.getQuestionnaires(l.link,o);s=s.concat(u)}t.model.questionnaires=s}else{const s=yield t.questionnaires.list(t.user,o);t.model.questionnaires=s.results}t.model.state="Loaded"}catch(s){t.model.state="Failed",console.error(`Failed to fetch questionnaires due to error: ${s}`)}})()}chooseQuestionnaire(t){var o=this;return(0,Y.Z)(function*(){t.marked=!1,o.appContext.requestParams.set("selectedQuestionnaire",t);const i=o.utils.urlToId(t.links.questionnaire);o.appContext.requestParams.set("questionnaireId",i),o.router.navigate(["questionnaires",i,"questionnaire"])})()}closeMultiselect(){this.elementRef.nativeElement.querySelector("#questionnaire-groups-label").click()}get questionnaireGroups(){return this.searchQuestionnairesForm.get("questionnaireGroups")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(K.P),e.Y36(M.sK),e.Y36(ie),e.Y36(we),e.Y36(w.F0),e.Y36(j.c),e.Y36(M.sK),e.Y36(e.SBq))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-other-questionnaires"]],decls:34,vars:29,consts:[[1,"container"],[3,"title","showChangePasswordBtn","showBackBtn","showLogoutBtn","showHomeBtn"],["id","notification-other-questionnaire-loading","class","notification info",4,"ngIf"],["id","notification-other-questionnaire-failed","class","notification error",4,"ngIf"],[1,"content"],[3,"formGroup","ngSubmit"],[1,"card"],[1,"header"],["aria-hidden","true",1,"icon","fa","fa-stethoscope"],[1,"form-group"],["for","questionnaire-groups","id","questionnaire-groups-label"],["formControlName","questionnaireGroups","id","questionnaire-groups",3,"placeholder","settings","data","onSelect","onSelectAll","onDeSelect"],[1,"form-group-margin-top"],["id","search","type","submit",1,"contained-btn",3,"disabled"],["class","fa fa-search",4,"ngIf"],["class","fa fa-spinner fa-spin",4,"ngIf"],["aria-hidden","true",1,"icon","fas","fa-list"],[4,"ngIf"],[1,"card-list"],["class","card-list-item",3,"click",4,"ngFor","ngForOf"],["id","notification-other-questionnaire-loading",1,"notification","info"],[1,"notification_icon","fas","fa-info-circle"],["id","notification-other-questionnaire-failed",1,"notification","error"],[1,"notification_icon","fas","fa-exclamation-triangle"],[1,"fa","fa-search"],[1,"fa","fa-spinner","fa-spin"],[1,"card-list-item",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"header-menu",1),e.YNc(2,Fe,4,3,"div",2),e.YNc(3,qe,4,3,"div",3),e.TgZ(4,"nav",4)(5,"form",5),e.NdJ("ngSubmit",function(){return o.search()}),e.TgZ(6,"div",6)(7,"div",7)(8,"h2"),e._UZ(9,"i",8),e._uU(10),e.ALo(11,"translate"),e.qZA()(),e.TgZ(12,"div",9)(13,"label",10),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"ng-multiselect-dropdown",11),e.NdJ("onSelect",function(){return o.closeMultiselect()})("onSelectAll",function(){return o.closeMultiselect()})("onDeSelect",function(){return o.closeMultiselect()}),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"div",12)(19,"button",13),e._uU(20),e.YNc(21,ke,1,0,"i",14),e.YNc(22,Ve,1,0,"i",15),e.qZA()(),e._UZ(23,"br")(24,"hr"),e.TgZ(25,"div",7)(26,"h2"),e._UZ(27,"i",16),e._uU(28),e.ALo(29,"translate"),e.qZA()(),e.YNc(30,Be,3,6,"p",17),e.YNc(31,Qe,3,3,"p",17),e.TgZ(32,"div",18),e.YNc(33,Ge,6,5,"div",19),e.qZA()()()()()),2&t&&(e.xp6(1),e.Q6J("title",o.title)("showChangePasswordBtn",!1)("showBackBtn",!0)("showLogoutBtn",!1)("showHomeBtn",!0),e.xp6(1),e.Q6J("ngIf","Loading"===o.model.state),e.xp6(1),e.Q6J("ngIf","Failed"===o.model.state),e.xp6(2),e.Q6J("formGroup",o.searchQuestionnairesForm),e.xp6(5),e.hij(" ",e.lcZ(11,21,"QUESTIONNAIRES")," "),e.xp6(4),e.Oqu(e.lcZ(15,23,"OTHER_QUESTIONNAIRES_QUESTIONNAIRE_GROUPS")),e.xp6(2),e.Q6J("placeholder",e.lcZ(17,25,"OTHER_QUESTIONNAIRES_QUESTIONNAIRE_GROUPS"))("settings",o.dropdownSettings)("data",o.questionnaireGroupList),e.xp6(3),e.Q6J("disabled","Loading"===o.model.state),e.xp6(1),e.hij(" \xa0 ","Loading"!==o.model.state?o.searchText:""," \xa0 "),e.xp6(1),e.Q6J("ngIf","Loading"!==o.model.state),e.xp6(1),e.Q6J("ngIf","Loading"===o.model.state),e.xp6(6),e.hij("",e.lcZ(29,27,"RESULTS")," "),e.xp6(2),e.Q6J("ngIf","Loaded"===o.model.state),e.xp6(1),e.Q6J("ngIf","Loaded"!==o.model.state),e.xp6(2),e.Q6J("ngForOf",o.model.questionnaires))},dependencies:[I.sg,I.O5,X.G,a._Y,a.JJ,a.JL,a.sg,a.u,Ne.OP,M.X$]}),n})(),Te=(()=>{class n{constructor(t){this.viewContainerRef=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.s_b))},n.\u0275dir=e.lG2({type:n,selectors:[["","nodeHost",""]]}),n})();var W=(()=>{return(n=W||(W={})).NAME="name",n.INTEGER="Integer",n.FLOAT="Float",n.BOOLEAN="Boolean",W;var n})(),C=(()=>{return(n=C||(C={})).NODE="node",n.SKIP="skip",n.END="end",n.UNSUPPORTED="unsupported",C;var n})(),$=O(7362),z=(()=>{return(n=z||(z={})).ACTIVITY_DEVICE_NODE="ActivityDeviceNode",n.BLOOD_PRESSURE_DEVICE_NODE="BloodPressureDeviceNode",n.BLOOD_SUGAR_DEVICE_NODE="BloodSugarDeviceNode",n.BLOOD_SUGAR_MGDL_DEVICE_NODE="BloodSugarMGDLDeviceNode",n.ECG_DEVICE_NODE="EcgDeviceNode",n.OXYGEN_FLOW_DEVICE_NODE="OxygenFlowDeviceNode",n.PULSE_DEVICE_NODE="PulseDeviceNode",n.SATURATION_DEVICE_NODE="SaturationDeviceNode",n.SATURATION_WITHOUT_PULSE_DEVICE_NODE="SaturationWithoutPulseDeviceNode",n.SPIROMETER_DEVICE_NODE="SpirometerDeviceNode",n.TEMPERATURE_DEVICE_NODE="TemperatureDeviceNode",n.TEMPERATURE_FAHRENHEIT_DEVICE_NODE="TemperatureFahrenheitDeviceNode",n.WEIGHT_DEVICE_NODE="WeightDeviceNode",n.WEIGHT_POUND_DEVICE_NODE="WeightPoundDeviceNode",n.FEMOM_DEVICE_NODE="FeMomDeviceNode",n.RESPIRATORY_RATE_DEVICE_NODE="RespiratoryRateDeviceNode",z;var n})(),se=(()=>{return(n=se||(se={})).ACTIVITY_MANUAL_DEVICE_NODE="ActivityManualDeviceNode",n.BLOOD_PRESSURE_MANUAL_DEVICE_NODE="BloodPressureManualDeviceNode",n.BLOOD_SUGAR_MANUAL_DEVICE_NODE="BloodSugarManualDeviceNode",n.BLOOD_SUGAR_MGDL_MANUAL_DEVICE_NODE="BloodSugarMGDLManualDeviceNode",n.BODY_CELL_MASS_MANUAL_DEVICE_NODE="BodyCellMassManualDeviceNode",n.CRP_MANUAL_DEVICE_NODE="CRPManualDeviceNode",n.FAT_MASS_MANUAL_DEVICE_NODE="FatMassManualDeviceNode",n.HEIGHT_MANUAL_DEVICE_NODE="HeightManualDeviceNode",n.HEMOGLOBIN_MANUAL_DEVICE_NODE="HemoglobinManualDeviceNode",n.OXYGEN_FLOW_MANUAL_DEVICE_NODE="OxygenFlowManualDeviceNode",n.PAIN_SCALE_MANUAL_DEVICE_NODE="PainScaleManualDeviceNode",n.PEAK_FLOW_MANUAL_DEVICE_NODE="PeakFlowManualDeviceNode",n.PHASE_ANGLE_MANUAL_DEVICE_NODE="PhaseAngleManualDeviceNode",n.PULSE_MANUAL_DEVICE_NODE="PulseManualDeviceNode",n.RESPIRATORY_RATE_MANUAL_DEVICE_NODE="RespiratoryRateManualDeviceNode",n.SATURATION_MANUAL_DEVICE_NODE="SaturationManualDeviceNode",n.SATURATION_WITHOUT_PULSE_MANUAL_DEVICE_NODE="SaturationWithoutPulseManualDeviceNode",n.SIT_TO_STAND_MANUAL_DEVICE_NODE="SitToStandManualDeviceNode",n.SPIROMETER_MANUAL_DEVICE_NODE="SpirometerManualDeviceNode",n.TEMPERATURE_MANUAL_DEVICE_NODE="TemperatureManualDeviceNode",n.TEMPERATURE_FAHRENHEIT_MANUAL_DEVICE_NODE="TemperatureFahrenheitManualDeviceNode",n.WEIGHT_MANUAL_DEVICE_NODE="WeightManualDeviceNode",n.WEIGHT_POUND_MANUAL_DEVICE_NODE="WeightPoundManualDeviceNode",se;var n})(),re=(()=>{return(n=re||(re={})).URINE_MANUAL_DEVICE_NODE="UrineManualDeviceNode",n.GLUCOSE_URINE_MANUAL_DEVICE_NODE="GlucoseUrineManualDeviceNode",n.BLOOD_URINE_MANUAL_DEVICE_NODE="BloodUrineManualDeviceNode",n.LEUKOCYTES_URINE_MANUAL_DEVICE_NODE="LeukocytesUrineManualDeviceNode",n.NITRITE_URINE_MANUAL_DEVICE_NODE="NitriteUrineManualDeviceNode",re;var n})(),ae=(()=>{return(n=ae||(ae={})).MULTIPLE_CHOICE_NODE="MultipleChoiceNode",n.MULTIPLE_CHOICE_QUESTION_NODE="MultipleChoiceQuestionNode",n.MULTIPLE_CHOICE_SUMMATION_NODE="MultipleChoiceSummationNode",ae;var n})(),le=(()=>{return(n=le||(le={})).DELAY_NODE="DelayNode",n.IO_NODE="IONode",n.ASSIGNMENT_NODE="AssignmentNode",n.DECISION_NODE="DecisionNode",n.END_NODE="EndNode",n.UNSUPPORTED_NODE="UNSUPPORTED_NODE",le;var n})();const _=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},z),se),re),ae),le);var q=(()=>{return(n=q||(q={})).AUTOMATIC="Automatic",n.MANUAL="Manual",n.UNKNOWN="Unknown",q;var n})();class T{constructor(r,t,o,i,s){this.component=r,this.node=t,this.nodeMap=o,this.scope=i,this.parameters=s}}const pe="([0-9]*[.,])?[0-9]+",me="[0-9]+";function Z(n){return null!=n}function H(n){const r={};for(const t in n.controls)r[t]=n.controls[t].value;return r}function B(n){const r=[];for(const t in n.controls)r.push(t);return r}let x=(()=>{class n{constructor(){this.replaceAll=(t,o,i)=>t.replace(new RegExp(o.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),i),this.measurementsNoRangeCheck=["mealIndicator"],this.checkInputRanges=(t,o,i)=>t.reduce((s,l)=>{const u=o[l];if(void 0===u&&this.measurementsNoRangeCheck.includes(l))return console.debug(`Skipping range check for: ${l}`),s;if(void 0===u)return console.error(`Unable to find ${l} on current node`),s;const d=u.range;if(null==d)return s;{const m=d.min,p=d.max;console.debug(`Valid range for "${l}": [${m}, ${p}]`);const c=i[l];return void 0===c?console.error(`Value of ${l} is undefined`):console.debug(`${l} value: ${c}`),m<=c&&c<=p?s:s.concat(l)}},[])}getFirstKeyFromLiteral(t){for(const o in t)if(t.hasOwnProperty(o))return o}getNodeTypeName(t){return this.getFirstKeyFromLiteral(t)}getElementType(t){return this.getFirstKeyFromLiteral(t)}hashCode(t){let o=0,i=0;if(0===t.length)return o;for(let s=0;s<t.length;s++)i=t.charCodeAt(s),o=(o<<5)-o+i,o|=0;return Math.abs(o)}addManualMeasurementOriginToOutput(t,o){if(o.origin){const i=o.origin.name;t[i]={name:i,type:o.origin.type,value:{manualMeasurement:{enteredBy:"citizen"}}}}}addMeasurementCommentToOutput(t,o,i){var s;if(i.comment){const l=i.comment.name,d=null===(s=o.comment)||void 0===s?void 0:s.text;t[l]={name:l,type:i.comment.type,value:d}}}addMeasurementsToOutput(t,o,i,s){s.forEach(l=>{const u=i[l].name;t[u]={name:u,type:i[l].type,value:o[l]}})}addHelpMenu(t,o){const i={text:void 0,image:void 0};t.helpText&&(i.text=t.helpText),t.helpImage&&(i.image=t.helpImage),void 0!==i.text||void 0!==i.image?o.helpMenu=i:delete o.helpMenu}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),R=(()=>{class n{constructor(t){this.element=t}ngOnChanges(){setTimeout(()=>{this.element[0].focus()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.SBq))},n.\u0275dir=e.lG2({type:n,selectors:[["","focusOnLoad",""]],features:[e.TTD]}),n})();function Ye(n,r){1&n&&(e.TgZ(0,"span",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const He=function(n){return{warning:n}};let We=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.nodeForm=this.formBuilder.group({dailySteps:["",a.kI.compose([a.kI.required,a.kI.pattern("[0-9]+")])]}),this.addMeasurement=(i,s,l)=>{i.dailySteps=Number(this.nodeForm.value.dailySteps),this.parserUtils.addMeasurementsToOutput(l.outputModel,i,s,["dailySteps"]),this.parserUtils.addMeasurementCommentToOutput(l.outputModel,i,s),this.parserUtils.addManualMeasurementOriginToOutput(l.outputModel,s)},this.validate=i=>!this.nodeForm.invalid}isOffendingValue(t){return this.scope.hasOffendingValue(t)}getRepresentation(){const t=this.node.comment,o=Object.assign(Object.assign({nodeId:this.node.nodeName,heading:this.node.text},t?{comment:t}:{}),{rangeCheck:s=>(s=Object.assign({nodeModel:s},H(this.nodeForm)),B(this.nodeForm),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,s))}),i=this.generateRepresentation(this.node,o);return this.parserUtils.addHelpMenu(this.node,i),i}generateRepresentation(t,o){return{kind:C.NODE,nodeModel:o,leftButton:{show:!0,text:"SKIP",nextNodeId:t.nextFail},rightButton:{show:!0,text:"NEXT",nextNodeId:t.next,validate:this.validate,click:l=>this.addMeasurement(o,t,l)}}}onSubmit(){console.log(this.nodeForm.value)}get dailySteps(){return this.nodeForm.get("dailySteps")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-activity-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:12,vars:11,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"block"],["for","daily-steps"],["id","daily-steps","name","daily-steps","type","number","step","1","focusOnLoad","","formControlName","dailySteps",3,"ngClass"],["id","daily-steps-warning","class","warning",4,"ngIf"],["id","daily-steps-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"fieldset",3)(6,"div",4)(7,"label",5),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._UZ(10,"input",6),e.YNc(11,Ye,3,3,"span",7),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(e.lcZ(4,5,o.node.text)),e.xp6(5),e.Oqu(e.lcZ(9,7,"DAILY_STEPS")),e.xp6(2),e.Q6J("ngClass",e.VKq(9,He,o.isOffendingValue("dailySteps"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("dailySteps")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,R,M.X$]}),n})();function Ke(n,r){1&n&&(e.TgZ(0,"span",14),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}function je(n,r){1&n&&(e.TgZ(0,"span",15),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}function Xe(n,r){1&n&&(e.TgZ(0,"span",16),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const he=function(n){return{warning:n}};let $e=(()=>{class n{constructor(t,o,i){this.formBuilder=t,this.parserUtils=o,this.utils=i,this.nodeForm=this.formBuilder.group({systolic:["",a.kI.compose([a.kI.required,a.kI.min(0),a.kI.max(999)])],diastolic:["",a.kI.compose([a.kI.required,a.kI.min(0),a.kI.max(999)])],pulse:["",a.kI.compose([a.kI.required,a.kI.min(0),a.kI.max(999)])]}),this.getRepresentation=()=>{const s=Object.assign(Object.assign({nodeId:this.node.nodeName,heading:this.node.text},this.node.comment?{comment:this.node.comment}:{}),{info:"CONNECTING",rangeCheck:c=>(c=Object.assign({nodeModel:c},H(this.nodeForm)),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,c))}),m={show:!0,text:"NEXT",nextNodeId:this.node.next,validate:c=>!this.nodeForm.invalid,click:c=>{const f=this.nodeForm.value;"systolic"in f&&"diastolic"in f&&"pulse"in f&&(this.utils.exists(f.systolic)&&(s.systolic=Number(f.systolic)),this.utils.exists(f.diastolic)&&(s.diastolic=Number(f.diastolic)),this.utils.exists(f.pulse)&&(s.pulse=Number(f.pulse)),this.parserUtils.addMeasurementsToOutput(c.outputModel,s,this.node,["systolic","diastolic","pulse"]),this.parserUtils.addMeasurementCommentToOutput(c.outputModel,s,this.node),this.parserUtils.addManualMeasurementOriginToOutput(c.outputModel,this.node))}},p={kind:C.NODE,nodeModel:s,leftButton:{show:!0,text:"SKIP",nextNodeId:this.node.nextFail},rightButton:m};return this.parserUtils.addHelpMenu(this.node,p),p}}isOffendingValue(t){return this.scope.hasOffendingValue(t)}onSubmit(){console.log(this.nodeForm.value)}get systolic(){return this.nodeForm.get("systolic")}get diastolic(){return this.nodeForm.get("diastolic")}get pulse(){return this.nodeForm.get("pulse")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x),e.Y36(j.c))},n.\u0275cmp=e.Xpm({type:n,selectors:[["blood-pressure-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:24,vars:25,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"block"],["for","blood-pressure-systolic"],["id","blood-pressure-systolic","type","number","name","blood-pressure-systolic","focusOnLoad","","formControlName","systolic",3,"ngClass"],["id","blood-pressure-systolic-warning","class","warning",4,"ngIf"],["for","blood-pressure-diastolic"],["id","blood-pressure-diastolic","type","number","name","blood-pressure-diastolic","formControlName","diastolic",3,"ngClass"],["id","blood-pressure-diastolic-warning","class","warning",4,"ngIf"],["for","blood-pressure-pulse"],["id","blood-pressure-pulse","type","number","name","blood-pressure-pulse","formControlName","pulse",3,"ngClass"],["id","blood-pressure-pulse-warning","class","warning",4,"ngIf"],["id","blood-pressure-systolic-warning",1,"warning"],["id","blood-pressure-diastolic-warning",1,"warning"],["id","blood-pressure-pulse-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"fieldset",3)(6,"div",4)(7,"label",5),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._UZ(10,"input",6),e.YNc(11,Ke,3,3,"span",7),e.qZA(),e.TgZ(12,"div",4)(13,"label",8),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"input",9),e.YNc(17,je,3,3,"span",10),e.qZA(),e.TgZ(18,"div",4)(19,"label",11),e._uU(20),e.ALo(21,"translate"),e.qZA(),e._UZ(22,"input",12),e.YNc(23,Xe,3,3,"span",13),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(e.lcZ(4,11,o.node.text)),e.xp6(5),e.hij(" ",e.lcZ(9,13,"BLOOD_PRESSURE_SYSTOLIC")," "),e.xp6(2),e.Q6J("ngClass",e.VKq(19,he,o.isOffendingValue("systolic"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("systolic")),e.xp6(3),e.hij(" ",e.lcZ(15,15,"BLOOD_PRESSURE_DIASTOLIC")," "),e.xp6(2),e.Q6J("ngClass",e.VKq(21,he,o.isOffendingValue("diastolic"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("diastolic")),e.xp6(3),e.hij(" ",e.lcZ(21,17,"BLOOD_PRESSURE_PULSE")," "),e.xp6(2),e.Q6J("ngClass",e.VKq(23,he,o.isOffendingValue("pulse"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("pulse")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,R,M.X$]}),n})();function ze(n,r){1&n&&(e.TgZ(0,"span",17),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const et=function(n){return{warning:n}};let tt=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.nodeForm=this.formBuilder.group({bloodSugarMeasurements:["",a.kI.compose([a.kI.required,a.kI.pattern("([0-9]*[.,])?[0-9]+")])],mealIndicator:["none",a.kI.required]}),this.getRepresentation=()=>{const i={nodeId:this.node.nodeName,heading:this.node.text,rangeCheck:d=>(d=Object.assign({nodeModel:d},H(this.nodeForm)),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,d))};"comment"in this.node&&(i.comment=this.node.comment);const l={show:!0,text:"NEXT",nextNodeId:this.node.next,validate:d=>!this.nodeForm.invalid,click:d=>{const m=this.node.bloodSugarMeasurements,p=m.name,c=m.type,h=this.nodeForm.value,f=h.mealIndicator;i.mealIndicator=f;const g=(new Date).toISOString();d.outputModel[p]={name:p,type:c,value:{measurements:[{result:h.bloodSugarMeasurements,isBeforeMeal:"bloodSugarManualBeforeMeal"===f||void 0,isAfterMeal:"bloodSugarManualAfterMeal"===f||void 0,isFasting:"bloodSugarManualFasting"===f||void 0,timeOfMeasurement:g}],transferTime:g}},this.parserUtils.addMeasurementCommentToOutput(d.outputModel,i,this.node),this.parserUtils.addManualMeasurementOriginToOutput(d.outputModel,this.node)}},u={kind:C.NODE,nodeModel:i,leftButton:{show:!0,text:"SKIP",nextNodeId:this.node.nextFail},rightButton:l};return this.parserUtils.addHelpMenu(this.node,u),u}}isOffendingValue(t){return this.scope.hasOffendingValue(t)}onSubmit(){console.log(this.nodeForm.value)}get bloodSugarMeasurements(){return this.nodeForm.get("bloodSugarMeasurements")}get mealIndicator(){return this.nodeForm.get("mealIndicator")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-blood-sugar-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:33,vars:21,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],["for","count"],["id","count","name","count","type","number","min","0","max","999","step","0.1","autocomplete","off","formControlName","bloodSugarMeasurements","focusOnLoad","",3,"ngClass"],["id","blood-sugar-warning","class","warning",4,"ngIf"],[1,"radio-list"],[1,"narrow-row","list-unstyled"],["id","beforeMeal","value","bloodSugarManualBeforeMeal","type","radio","name","mealIndicator","formControlName","mealIndicator","value","bloodSugarManualBeforeMeal"],["for","beforeMeal",1,"radio-label"],["id","afterMeal","value","bloodSugarManualAfterMeal","type","radio","name","mealIndicator","formControlName","mealIndicator","value","bloodSugarManualAfterMeal"],["for","afterMeal",1,"radio-label"],["id","fasting","value","bloodSugarManualFasting","type","radio","name","mealIndicator","formControlName","mealIndicator","value","bloodSugarManualFasting"],["for","fasting",1,"radio-label"],["id","none","value","none","name","mealIndicator","formControlName","mealIndicator","type","radio","checked",""],["for","none",1,"radio-label"],["id","blood-sugar-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset",3)(5,"div")(6,"label",4),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"input",5),e.YNc(10,ze,3,3,"span",6),e.qZA(),e.TgZ(11,"div")(12,"ul",7)(13,"li",8),e._UZ(14,"input",9),e.TgZ(15,"label",10),e._uU(16),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"li",8),e._UZ(19,"input",11),e.TgZ(20,"label",12),e._uU(21),e.ALo(22,"translate"),e.qZA()(),e.TgZ(23,"li",8),e._UZ(24,"input",13),e.TgZ(25,"label",14),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"li",8),e._UZ(29,"input",15),e.TgZ(30,"label",16),e._uU(31),e.ALo(32,"translate"),e.qZA()()()()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(4),e.Oqu(e.lcZ(8,9,"BLOOD_SUGAR")),e.xp6(2),e.Q6J("ngClass",e.VKq(19,et,o.isOffendingValue("bloodSugarMeasurements"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("bloodSugarMeasurements")),e.xp6(6),e.Oqu(e.lcZ(17,11,"BEFORE_MEAL")),e.xp6(5),e.Oqu(e.lcZ(22,13,"AFTER_MEAL")),e.xp6(5),e.Oqu(e.lcZ(27,15,"FASTING")),e.xp6(5),e.Oqu(e.lcZ(32,17,"NO_MEAL_INDICATOR")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a._,a.JJ,a.JL,a.qQ,a.Fd,a.sg,a.u,R,M.X$]}),n})();function nt(n,r){1&n&&(e.TgZ(0,"span",17),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const ot=function(n){return{warning:n}};let it=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.nodeForm=this.formBuilder.group({bloodSugarMeasurements:["",a.kI.compose([a.kI.required,a.kI.pattern("([0-9]*[.,])?[0-9]+")])],mealIndicator:["none",a.kI.required]}),this.getRepresentation=()=>{const i={nodeId:this.node.nodeName,heading:this.node.text,rangeCheck:d=>(d=Object.assign({nodeModel:d},H(this.nodeForm)),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,d))};"comment"in this.node&&(i.comment=this.node.comment);const l={show:!0,text:"NEXT",nextNodeId:this.node.next,validate:d=>!this.nodeForm.invalid,click:d=>{const m=this.node.bloodSugarMeasurements,p=m.name,c=m.type,h=this.nodeForm.value,f=h.mealIndicator;i.mealIndicator=f;const g=(new Date).toISOString();d.outputModel[p]={name:p,type:c,value:{measurements:[{result:h.bloodSugarMeasurements,isBeforeMeal:"bloodSugarManualBeforeMeal"===f||void 0,isAfterMeal:"bloodSugarManualAfterMeal"===f||void 0,isFasting:"bloodSugarManualFasting"===f||void 0,timeOfMeasurement:g}],transferTime:g}},this.parserUtils.addMeasurementCommentToOutput(d.outputModel,i,this.node),this.parserUtils.addManualMeasurementOriginToOutput(d.outputModel,this.node)}},u={kind:C.NODE,nodeModel:i,leftButton:{show:!0,text:"SKIP",nextNodeId:this.node.nextFail},rightButton:l};return this.parserUtils.addHelpMenu(this.node,u),u}}isOffendingValue(t){return this.scope.hasOffendingValue(t)}onSubmit(){console.log(this.nodeForm.value)}get bloodSugarMeasurements(){return this.nodeForm.get("bloodSugarMeasurements")}get mealIndicator(){return this.nodeForm.get("mealIndicator")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-blood-sugar-mgdl-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:33,vars:21,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],["for","count"],["id","count","name","count","type","number","min","0","max","999","step","0.1","autocomplete","off","formControlName","bloodSugarMeasurements","focusOnLoad","",3,"ngClass"],["id","blood-sugar-warning","class","warning",4,"ngIf"],[1,"radio-list"],[1,"narrow-row","list-unstyled"],["id","beforeMeal","name","mealIndicator","type","radio","formControlName","mealIndicator","value","bloodSugarManualBeforeMeal"],["for","beforeMeal",1,"radio-label"],["id","afterMeal","name","mealIndicator","type","radio","formControlName","mealIndicator","value","bloodSugarManualAfterMeal"],["for","afterMeal",1,"radio-label"],["id","fasting","name","mealIndicator","type","radio","formControlName","mealIndicator","value","bloodSugarManualFasting"],["for","fasting",1,"radio-label"],["id","none","name","mealIndicator","formControlName","mealIndicator","type","radio","value","none","checked",""],["for","none",1,"radio-label"],["id","blood-sugar-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset",3)(5,"div")(6,"label",4),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"input",5),e.YNc(10,nt,3,3,"span",6),e.qZA(),e.TgZ(11,"div")(12,"ul",7)(13,"li",8),e._UZ(14,"input",9),e.TgZ(15,"label",10),e._uU(16),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"li",8),e._UZ(19,"input",11),e.TgZ(20,"label",12),e._uU(21),e.ALo(22,"translate"),e.qZA()(),e.TgZ(23,"li",8),e._UZ(24,"input",13),e.TgZ(25,"label",14),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"li",8),e._UZ(29,"input",15),e.TgZ(30,"label",16),e._uU(31),e.ALo(32,"translate"),e.qZA()()()()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(4),e.Oqu(e.lcZ(8,9,"BLOOD_SUGAR_MG_DL")),e.xp6(2),e.Q6J("ngClass",e.VKq(19,ot,o.isOffendingValue("bloodSugarMeasurements"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("bloodSugarMeasurements")),e.xp6(6),e.Oqu(e.lcZ(17,11,"BEFORE_MEAL")),e.xp6(5),e.Oqu(e.lcZ(22,13,"AFTER_MEAL")),e.xp6(5),e.Oqu(e.lcZ(27,15,"FASTING")),e.xp6(5),e.Oqu(e.lcZ(32,17,"NO_MEAL_INDICATOR")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a._,a.JJ,a.JL,a.qQ,a.Fd,a.sg,a.u,R,M.X$]}),n})();function st(n,r){1&n&&(e.TgZ(0,"span",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const rt=function(n){return{warning:n}};let at=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.nodeForm=this.formBuilder.group({crpLt5Measurement:[!1],crpCountMeasurement:["",[a.kI.required,a.kI.pattern(pe)]]}),this.getRepresentation=()=>{const i={nodeId:this.node.nodeName,heading:this.node.text,rangeCheck:d=>(d=Object.assign({nodeModel:d},{CRP:this.getValue()}),this.parserUtils.checkInputRanges(["CRP"],this.node,d))};"comment"in this.node&&(i.comment=this.node.comment);const u={kind:C.NODE,nodeModel:i,leftButton:{show:!0,text:"SKIP",nextNodeId:this.node.nextFail},rightButton:{show:!0,text:"NEXT",nextNodeId:this.node.next,validate:()=>(()=>{const p=this.nodeForm.getRawValue();return!0===p.crpLt5Measurement&&(null==p.crpCountMeasurement||0===p.crpCountMeasurement.toString().length)})()||(()=>{const p=this.nodeForm.value;return!0!==p.crpLt5Measurement&&null!=p.crpCountMeasurement&&0<=Number(p.crpCountMeasurement)&&0<p.crpCountMeasurement.toString().length})(),click:d=>{const m=this.node.CRP;if(void 0===m)throw new Error("CRP Value not properly defined");const p=this.nodeForm.getRawValue(),c=m.name,h=p.crpLt5Measurement,f=Number(p.crpCountMeasurement);d.outputModel[c]={name:c,type:m.type,value:this.getValue()},this.parserUtils.addMeasurementCommentToOutput(d.outputModel,{nodeId:i.nodeId,crpLt5Measurement:h,crpCountMeasurement:f},this.node),this.parserUtils.addManualMeasurementOriginToOutput(d.outputModel,this.node)}}};return this.parserUtils.addHelpMenu(this.node,u),u}}isOffendingValue(t){return this.scope.hasOffendingValue(t)}getValue(){if(void 0===this.node.CRP)throw new Error("CRP Value not properly defined");const o=this.nodeForm.getRawValue(),i=o.crpLt5Measurement,s=Number(o.crpCountMeasurement);return i||s<5?0:s}onSubmit(){console.log(this.nodeForm.value)}get crpLt5Measurement(){return this.nodeForm.get("crpLt5Measurement")}get crpCountMeasurement(){return this.nodeForm.get("crpCountMeasurement")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-crp-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:16,vars:12,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],["for","lt5"],["id","lt5","name","lt5","type","checkbox","formControlName","crpLt5Measurement"],["for","count"],["id","count","name","count","type","number","step","0.1","autocomplete","off","focusOnLoad","","formControlName","crpCountMeasurement",3,"ngClass"],["id","crp-warning","class","warning",4,"ngIf"],["id","crp-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset",3)(5,"div")(6,"label",4),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"input",5),e.qZA(),e.TgZ(10,"div")(11,"label",6),e._uU(12),e.ALo(13,"translate"),e.qZA(),e._UZ(14,"input",7),e.YNc(15,st,3,3,"span",8),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(4),e.Oqu(e.lcZ(8,6,"LT5")),e.xp6(5),e.Oqu(e.lcZ(13,8,"OR_CRP")),e.xp6(2),e.Q6J("ngClass",e.VKq(10,rt,o.isOffendingValue("CRP"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("CRP")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a.Wl,a.JJ,a.JL,a.sg,a.u,R,M.X$]}),n})();function lt(n,r){if(1&n&&(e.TgZ(0,"li",5),e._UZ(1,"input",6),e.TgZ(2,"label",7),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"br"),e.qZA()()),2&n){const t=r.$implicit,o=r.index;e.xp6(1),e.MGl("id","radio-",o,""),e.s9C("value",o),e.xp6(1),e.MGl("for","radio-",o,""),e.xp6(1),e.hij(" ",e.lcZ(4,4,t.level),"")}}let ee=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.inputs=[],this.nodeForm=this.formBuilder.group({enum:["",a.kI.required]}),this.getRepresentation=()=>{const i=this.enumDeviceNodeParserTypes.find(c=>c.typeName===this.parameters.parserTypeName),s=i.typeName,l=i.values;for(const c of l)this.inputs.push({nodeTypeName:s,level:c});const u={nodeId:this.node.nodeName,heading:this.node.text,enumValues:l};"comment"in this.node&&(u.comment=this.node.comment);const m={show:!0,text:"NEXT",nextNodeId:this.node.next,validate:c=>!this.nodeForm.invalid,click:c=>{const f=[s];u[s]=parseInt(this.nodeForm.value.enum,10),this.parserUtils.addMeasurementsToOutput(c.outputModel,u,this.node,f),this.parserUtils.addMeasurementCommentToOutput(c.outputModel,u,this.node),this.parserUtils.addManualMeasurementOriginToOutput(c.outputModel,this.node)}},p={kind:C.NODE,nodeModel:u,leftButton:{show:!0,text:"SKIP",nextNodeId:this.node.nextFail},rightButton:m};return this.parserUtils.addHelpMenu(this.node,p),p},this.enumDeviceNodeParserTypes=[{typeName:"bloodUrine",values:["URINE_LEVEL_NEGATIVE","URINE_LEVEL_PLUS_MINUS","URINE_LEVEL_PLUS_ONE","URINE_LEVEL_PLUS_TWO","URINE_LEVEL_PLUS_THREE"]},{typeName:"glucoseUrine",values:["URINE_LEVEL_NEGATIVE","URINE_LEVEL_PLUS_ONE","URINE_LEVEL_PLUS_TWO","URINE_LEVEL_PLUS_THREE","URINE_LEVEL_PLUS_FOUR"]},{typeName:"leukocytesUrine",values:["URINE_LEVEL_NEGATIVE","URINE_LEVEL_PLUS_ONE","URINE_LEVEL_PLUS_TWO","URINE_LEVEL_PLUS_THREE","URINE_LEVEL_PLUS_FOUR"]},{typeName:"nitriteUrine",values:["URINE_LEVEL_NEGATIVE","URINE_LEVEL_POSITIVE"]},{typeName:"urine",values:["URINE_LEVEL_NEGATIVE","URINE_LEVEL_PLUS_MINUS","URINE_LEVEL_PLUS_ONE","URINE_LEVEL_PLUS_TWO","URINE_LEVEL_PLUS_THREE","URINE_LEVEL_PLUS_FOUR"]}]}onSubmit(){console.log(this.nodeForm.value)}get enum(){return this.nodeForm.get("enum")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-enum-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:8,vars:3,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],["class","narrow-row list-unstyled",4,"ngFor","ngForOf"],[1,"narrow-row","list-unstyled"],["type","radio","name","enum","formControlName","enum",3,"id","value"],[1,"radio-label",3,"for"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset",3)(5,"div")(6,"ul"),e.YNc(7,lt,6,6,"li",4),e.qZA()()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(4),e.Q6J("ngForOf",o.inputs))},dependencies:[I.sg,a._Y,a.Fj,a._,a.JJ,a.JL,a.sg,a.u,M.X$]}),n})();var ve=O(2313);let ut=(()=>{class n{constructor(t){this.sanitizer=t}transform(t,o){switch(o){case"html":return this.sanitizer.bypassSecurityTrustHtml(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(t);default:throw new Error(`Invalid safe type specified: ${o}`)}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ve.H7,16))},n.\u0275pipe=e.Yjl({name:"safe",type:n,pure:!0}),n})();function dt(n,r){if(1&n&&(e.TgZ(0,"div",4),e._UZ(1,"h2",5),e.ALo(2,"safe"),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("innerHtml",e.xi3(2,1,t,"html"),e.oJD)}}function ct(n,r){if(1&n&&(e.TgZ(0,"fieldset",6)(1,"div",7)(2,"label",8),e._uU(3),e.qZA(),e._UZ(4,"textarea",9),e.qZA()()),2&n){const t=r.$implicit,o=r.index;e.xp6(2),e.Q6J("for",t.name),e.xp6(1),e.Oqu(t.label),e.xp6(1),e.Q6J("formControlName",o)}}function pt(n,r){if(1&n&&(e.TgZ(0,"fieldset",10)(1,"div",7)(2,"label",11),e._uU(3),e.qZA(),e._UZ(4,"input",12),e.qZA()()),2&n){const t=r.$implicit,o=r.index;e.xp6(2),e.Q6J("for",t.name),e.xp6(1),e.Oqu(null==t?null:t.label),e.xp6(1),e.Q6J("id",null==t?null:t.name)("name",null==t?null:t.name)("formControlName",o)("type",null==t?null:t.type)("step",null==t?null:t.step)}}let mt=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.textInputs=[],this.inputs=[],this.nodeForm=this.formBuilder.group({textInputControls:this.formBuilder.array([]),inputControls:this.formBuilder.array([])}),this.labels=[],this.clickActions=[],this.validateActions=[],this.callHandler=(i,s,l)=>{switch(i){case"TextViewElement":this.handleTextViewElement(s);break;case"OriginElement":this.handleOriginElement(s);break;case"EditTextElement":this.handleEditTextElement(s);break;case"ButtonElement":this.handleButtonElement(s,l);break;case"TwoButtonElement":this.handleTwoButtonElement(s,l);break;case"HelpTextElement":this.handleHelpTextElement(s,l);break;default:console.error(`Unable to call handler for element type: ${i} for IONode`)}},this.handleTextViewElement=i=>this.labels.push(i.text),this.handleOriginElement=i=>{this.clickActions.push(s=>{const u=i.outputVariable.name;s.outputModel[u]={name:u,type:i.outputVariable.type,value:{manualMeasurement:{enteredBy:"citizen"}}}})},this.handleEditTextElement=i=>{var s;const l=i.outputVariable.type;if(!["String","Integer","Float"].includes(l))throw new Error("Unexpected element type for EditTextElement: "+l);const u="String"===l?"text":"number",d=`input_${u}_${this.parserUtils.hashCode(i.outputVariable.name)}`,m="String"===l?/.*/:/(\d*[.,])?\d+/,p="Integer"===l?"1":"any";let c;c="String"===l?[a.kI.required,a.kI.minLength(1),a.kI.maxLength(1800)]:"Integer"===l?[a.kI.required,this.isInteger]:[a.kI.required,a.kI.pattern(m)];const h={name:d,type:u,pattern:m,step:p,label:null!==(s=this.labels.pop())&&void 0!==s?s:""};"text"===u?(this.textInputs.push(h),this.textInputControls.push(this.formBuilder.control("",c))):(this.inputs.push(h),this.inputControls.push(this.formBuilder.control("",c))),this.clickActions.push(f=>{const g=i.outputVariable.name;let E;if("text"===u){const v=this.textInputs.findIndex(({name:N})=>N===d);v>=0&&(E=this.textInputControls.at(v).value)}else{const v=this.inputs.findIndex(N=>N.name===d);v>=0&&(E=this.inputControls.at(v).value)}E?f.outputModel[g]={name:g,value:E,type:l}:console.error(`Variabel in output model for name: '${g}', type: ${l} was undefined`)}),this.validateActions.push(f=>!this.nodeForm.invalid)},this.handleButtonElement=(i,s)=>{const l={show:!0,text:i.text,nextNodeId:i.next};switch(this.setupClickActions(i.skipValidation,l),i.gravity){case"center":s.centerButton=l;break;case"right":s.rightButton=l;break;case"left":s.leftButton=l}}}getRepresentation(){const t={kind:C.NODE,nodeModel:{nodeId:this.node.nodeName}};return this.node.elements.forEach(o=>{const i=this.parserUtils.getElementType(o);this.callHandler(i,o[i],t)}),t}handleTwoButtonElement(t,o){var i,s;const l={show:!0,text:t.leftText,nextNodeId:t.leftNext};this.setupClickActions(null!==(i=t.leftSkipValidation)&&void 0!==i&&i,l),o.leftButton=l;const u={show:!0,text:t.rightText,nextNodeId:t.rightNext};this.setupClickActions(null!==(s=t.rightSkipValidation)&&void 0!==s&&s,u),o.rightButton=u}setupClickActions(t,o){t||(o.click=i=>{for(let s=0;s<this.clickActions.length;s++)this.clickActions[s](i)},o.validate=i=>{for(let s=0;s<this.validateActions.length;s++)if(!1===this.validateActions[s](i))return!1;return!0})}handleHelpTextElement(t,o){if(null==t)return;const i={nodeName:"",next:"",nextFail:"",text:""};t.text&&(i.helpText=t.text),t.image&&(i.helpImage=t.image),this.parserUtils.addHelpMenu(i,o)}onSubmit(){console.log(this.nodeForm.value)}get textInputControls(){return this.nodeForm.get("textInputControls")}get inputControls(){return this.nodeForm.get("inputControls")}isInteger(t){const o=""===t.value?void 0:Number(t.value);return Number.isInteger(o)?(console.debug("is Actually an integer"),null):(console.debug("is Actually not an integer"),{must_be_integer:`${o} is not an Integer`})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-ionode"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:4,vars:4,consts:[[3,"formGroup","ngSubmit"],["class","center-div",4,"ngFor","ngForOf"],["formArrayName","textInputControls","class","questionnaire-fields",4,"ngFor","ngForOf"],["formArrayName","inputControls","class","questionnaire-fields",4,"ngFor","ngForOf"],[1,"center-div"],[1,"line-wrap","text-element",3,"innerHtml"],["formArrayName","textInputControls",1,"questionnaire-fields"],[1,"block"],[2,"display","block",3,"for"],["id","textInput.name","name","textInput.name","rows","8","autocomplete","off","maxlength","1800","type","textInput.type","focusOnLoad","",2,"display","block",3,"formControlName"],["formArrayName","inputControls",1,"questionnaire-fields"],[3,"for"],["autocomplete","off","focusOnLoad","",3,"id","name","formControlName","type","step"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.YNc(1,dt,3,4,"div",1),e.YNc(2,ct,5,3,"fieldset",2),e.YNc(3,pt,5,7,"fieldset",3),e.qZA()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(1),e.Q6J("ngForOf",o.labels),e.xp6(1),e.Q6J("ngForOf",o.textInputs),e.xp6(1),e.Q6J("ngForOf",o.inputs))},dependencies:[I.sg,a._Y,a.Fj,a.JJ,a.JL,a.nD,a.sg,a.u,a.CE,R,ut]}),n})(),ht=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.defaultValue=5,this.nodeForm=this.formBuilder.group({painScaleMeasurement:[this.defaultValue,a.kI.required]})}getRepresentation(){return((o,i,s)=>{const l={nodeId:o.nodeName,heading:o.text,painScaleMeasurement:this.defaultValue};"comment"in o&&(l.comment=o.comment);const m={kind:C.NODE,nodeModel:l,leftButton:{show:!0,text:"SKIP",nextNodeId:o.nextFail},rightButton:{show:!0,text:"NEXT",nextNodeId:o.next,click:p=>{const c=o.painScale.name;if("painScaleMeasurement"in this.nodeForm.value){const h=this.nodeForm.getRawValue();p.outputModel[c]={name:c,type:o.painScale.type,value:h.painScaleMeasurement},this.parserUtils.addMeasurementCommentToOutput(p.outputModel,l,o)}}}};return this.parserUtils.addHelpMenu(o,m),m})(this.node)}onSubmit(){console.log(this.nodeForm.value)}get painScaleMeasurement(){return this.nodeForm.get("painScaleMeasurement")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-pain-scale-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:13,vars:12,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],["src","./assets/images/vas-score.png","css","info-image",3,"alt"],["id","painScale","name","painScale","type","range","min","0","max","10","step","0.1","focusOnLoad","","formControlName","painScaleMeasurement","required",""],["for","painScale"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset")(5,"div"),e._UZ(6,"img",3),e.ALo(7,"translate"),e._UZ(8,"input",4),e.TgZ(9,"label",5),e._uU(10),e.ALo(11,"translate"),e.ALo(12,"number"),e.qZA()()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(3),e.s9C("alt",e.lcZ(7,5,"PAIN_SCALE_ARIA")),e.xp6(4),e.AsE(" ",e.lcZ(11,7,"PAIN_SCALE_CHOSEN_VALUE"),": ",e.xi3(12,9,o.nodeForm.value.painScaleMeasurement,"1.1-1")," "))},dependencies:[a._Y,a.Fj,a.eT,a.JJ,a.JL,a.Q7,a.sg,a.u,R,I.JJ,M.X$]}),n})();function ft(n,r){1&n&&(e.TgZ(0,"span",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}function _t(n,r){1&n&&(e.TgZ(0,"span",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const Ie=function(n){return{warning:n}};let gt=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.nodeForm=this.formBuilder.group({saturation:["",a.kI.compose([a.kI.required,a.kI.pattern(me)])],pulse:["",a.kI.compose([a.kI.required,a.kI.pattern(me)])]})}isOffendingValue(t){return this.scope.hasOffendingValue(t)}getRepresentation(){const t=s=>!this.nodeForm.invalid,o=(s,l)=>({kind:C.NODE,nodeModel:l,leftButton:{show:!0,text:"SKIP",nextNodeId:s.nextFail},rightButton:{show:!0,text:"NEXT",nextNodeId:s.next,validate:t,click:c=>{this.parserUtils.addMeasurementsToOutput(c.outputModel,this.nodeForm.value,s,["saturation","pulse"]),this.parserUtils.addMeasurementCommentToOutput(c.outputModel,l,s),this.parserUtils.addManualMeasurementOriginToOutput(c.outputModel,s)}}});return(s=>{const l={nodeId:s.nodeName,heading:s.text,info:"CONNECTING",rangeCheck:d=>(d=Object.assign({nodeModel:d},H(this.nodeForm)),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,d))};"comment"in s&&(l.comment=s.comment);const u=o(s,l);return this.parserUtils.addHelpMenu(s,u),u})(this.node)}onSubmit(){console.log(this.nodeForm.value)}get saturation(){return this.nodeForm.get("saturation")}get pulse(){return this.nodeForm.get("pulse")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-saturation-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:18,vars:18,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"block"],["for","saturation-saturation"],["id","saturation-saturation","name","saturation-saturation","type","number","step","1","focusOnLoad","","formControlName","saturation",3,"ngClass"],["id","saturation-warning","class","warning",4,"ngIf"],["for","saturation-pulse"],["id","saturation-pulse","name","saturation-pulse","type","number","step","1","formControlName","pulse",3,"ngClass"],["id","pulse-warning","class","warning",4,"ngIf"],["id","saturation-warning",1,"warning"],["id","pulse-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"fieldset",3)(6,"div",4)(7,"label",5),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._UZ(10,"input",6),e.YNc(11,ft,3,3,"span",7),e.qZA(),e.TgZ(12,"div",4)(13,"label",8),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"input",9),e.YNc(17,_t,3,3,"span",10),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(e.lcZ(4,8,o.node.text)),e.xp6(5),e.Oqu(e.lcZ(9,10,"SATURATION_SATURATION")),e.xp6(2),e.Q6J("ngClass",e.VKq(14,Ie,o.isOffendingValue("saturation"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("saturation")),e.xp6(3),e.Oqu(e.lcZ(15,12,"SATURATION_PULSE")),e.xp6(2),e.Q6J("ngClass",e.VKq(16,Ie,o.isOffendingValue("pulse"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("pulse")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,R,M.X$]}),n})();function Et(n,r){1&n&&(e.TgZ(0,"span",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const Nt=function(n){return{warning:n}};let Tt=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.nodeForm=this.formBuilder.group({saturation:["",a.kI.compose([a.kI.required,a.kI.pattern(me)])]})}isOffendingValue(t){return this.scope.hasOffendingValue(t)}getRepresentation(){const t=s=>!this.nodeForm.invalid,o=(s,l)=>({kind:C.NODE,nodeModel:l,leftButton:{show:!0,text:"SKIP",nextNodeId:s.nextFail},rightButton:{show:!0,text:"NEXT",nextNodeId:s.next,validate:t,click:c=>{this.parserUtils.addMeasurementsToOutput(c.outputModel,this.nodeForm.value,s,["saturation"]),this.parserUtils.addMeasurementCommentToOutput(c.outputModel,l,s),this.parserUtils.addManualMeasurementOriginToOutput(c.outputModel,s)}}});return((s,l,u)=>{const d={nodeId:s.nodeName,heading:s.text,info:"CONNECTING",rangeCheck:p=>(p=Object.assign({nodeModel:p},H(this.nodeForm)),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,p))};"comment"in s&&(d.comment=s.comment);const m=o(s,d);return this.parserUtils.addHelpMenu(s,m),m})(this.node)}onSubmit(){console.log(this.nodeForm.value)}get saturation(){return this.nodeForm.get("saturation")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-saturation-without-pulse-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:12,vars:11,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"block"],["for","saturation-saturation"],["id","saturation-saturation","name","saturation-saturation","type","number","step","1","focusOnLoad","","formControlName","saturation",3,"ngClass"],["id","saturation-warning","class","warning",4,"ngIf"],["id","saturation-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"fieldset",3)(6,"div",4)(7,"label",5),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._UZ(10,"input",6),e.YNc(11,Et,3,3,"span",7),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(e.lcZ(4,5,o.node.text)),e.xp6(5),e.Oqu(e.lcZ(9,7,"SATURATION_SATURATION")),e.xp6(2),e.Q6J("ngClass",e.VKq(9,Nt,o.isOffendingValue("saturation"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("saturation")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,R,M.X$]}),n})();function vt(n,r){1&n&&(e.TgZ(0,"span",17),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}function It(n,r){1&n&&(e.TgZ(0,"span",18),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}function Ot(n,r){1&n&&(e.TgZ(0,"span",19),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}function Ct(n,r){1&n&&(e.TgZ(0,"span",20),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const ue=function(n){return{warning:n}};let Mt=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.validators=a.kI.compose([a.kI.required,a.kI.pattern(pe)]),this.optionalValidators=a.kI.pattern(pe),this.nodeForm=this.formBuilder.group({fev1:["",this.validators],fev6:["",this.optionalValidators],fev1Fev6Ratio:["",this.optionalValidators],fef2575:["",this.optionalValidators]})}isOffendingValue(t){return this.scope.hasOffendingValue(t)}getRepresentation(){const t=s=>!this.nodeForm.invalid,o=(s,l)=>({kind:C.NODE,nodeModel:l,leftButton:{show:!0,text:"SKIP",nextNodeId:s.nextFail},rightButton:{show:!0,text:"NEXT",nextNodeId:s.next,validate:t,click:c=>{this.parserUtils.addMeasurementsToOutput(c.outputModel,this.nodeForm.value,s,["fev1","fev6","fev1Fev6Ratio","fef2575"]),this.parserUtils.addMeasurementCommentToOutput(c.outputModel,l,s),this.parserUtils.addManualMeasurementOriginToOutput(c.outputModel,s)}}});return((s,l,u)=>{const d={nodeId:s.nodeName,heading:s.text,info:"CONNECTING",rangeCheck:p=>(p=Object.assign({nodeModel:p},H(this.nodeForm)),this.parserUtils.checkInputRanges(B(this.nodeForm),this.node,p))};"comment"in s&&(d.comment=s.comment);const m=o(s,d);return this.parserUtils.addHelpMenu(s,m),m})(this.node)}onSubmit(){console.log(this.nodeForm.value)}get fev1(){return this.nodeForm.get("fev1")}get fev6(){return this.nodeForm.get("fev6")}get fev1Fev6Ratio(){return this.nodeForm.get("fev1Fev6Ratio")}get fef2575(){return this.nodeForm.get("fef2575")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-spirometer-manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:30,vars:32,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"block"],["for","spirometer-fev1"],["id","spirometer-fev1","name","spirometer-fev1","type","number","step","0.1","focusOnLoad","","formControlName","fev1",3,"ngClass"],["id","fev1-warning","class","warning",4,"ngIf"],["for","spirometer-fev6"],["id","spirometer-fev6","name","spirometer-fev6","type","number","step","0.1","formControlName","fev6",3,"ngClass"],["id","fev6-warning","class","warning",4,"ngIf"],["for","spirometer-fev1Fev6Ratio"],["id","spirometer-fev1Fev6Ratio","name","spirometer-fev1Fev6Ratio","type","number","step","0.1","formControlName","fev1Fev6Ratio",3,"ngClass"],["id","fev1-fev6-ratio-warning","class","warning",4,"ngIf"],["for","spirometer-fef2575"],["id","spirometer-fef2575","name","spirometer-fef2575","type","number","step","0.1","formControlName","fef2575",3,"ngClass"],["id","fef2575-warning","class","warning",4,"ngIf"],["id","fev1-warning",1,"warning"],["id","fev6-warning",1,"warning"],["id","fev1-fev6-ratio-warning",1,"warning"],["id","fef2575-warning",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"fieldset",3)(6,"div",4)(7,"label",5),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._UZ(10,"input",6),e.YNc(11,vt,3,3,"span",7),e.qZA(),e.TgZ(12,"div",4)(13,"label",8),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"input",9),e.YNc(17,It,3,3,"span",10),e.qZA(),e.TgZ(18,"div",4)(19,"label",11),e._uU(20),e.ALo(21,"translate"),e.qZA(),e._UZ(22,"input",12),e.YNc(23,Ot,3,3,"span",13),e.qZA(),e.TgZ(24,"div",4)(25,"label",14),e._uU(26),e.ALo(27,"translate"),e.qZA(),e._UZ(28,"input",15),e.YNc(29,Ct,3,3,"span",16),e.qZA()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(e.lcZ(4,14,o.node.text)),e.xp6(5),e.Oqu(e.lcZ(9,16,"SPIROMETER_FEV1")),e.xp6(2),e.Q6J("ngClass",e.VKq(24,ue,o.isOffendingValue("fev1"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("fev1")),e.xp6(3),e.Oqu(e.lcZ(15,18,"SPIROMETER_FEV6")),e.xp6(2),e.Q6J("ngClass",e.VKq(26,ue,o.isOffendingValue("fev6"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("fev6")),e.xp6(3),e.Oqu(e.lcZ(21,20,"SPIROMETER_FEV1_FEV6_RATIO")),e.xp6(2),e.Q6J("ngClass",e.VKq(28,ue,o.isOffendingValue("fev1Fev6Ratio"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("fev1Fev6Ratio")),e.xp6(3),e.Oqu(e.lcZ(27,22,"SPIROMETER_FEF25_75")),e.xp6(2),e.Q6J("ngClass",e.VKq(30,ue,o.isOffendingValue("fef2575"))),e.xp6(1),e.Q6J("ngIf",o.isOffendingValue("fef2575")))},dependencies:[I.mk,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,R,M.X$]}),n})(),At=(()=>{class n{constructor(){}getRepresentation(){const t=this.node.variable;return this.scope.outputModel[t.name]={name:t.name,type:t.type,value:this.node.expression.value},{kind:C.SKIP,nodeModel:{nodeId:this.node.nodeName},nextNodeId:this.node.next}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-assignment-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:0,vars:0,template:function(t,o){}}),n})();var k=(()=>{return(n=k||(k={})).LESS_THAN="lt",n.GREATER_THAN="gt",n.EQUAL="eq",k;var n})();let St=(()=>{class n{constructor(){this.getOperator=t=>{for(var o in t.expression)switch(o){case"lt":return k.LESS_THAN;case"gt":return k.GREATER_THAN;case"eq":return k.EQUAL;default:throw new Error(`Unsupported operator: ${o}`)}throw new Error("Empty DecisionNode")},this.getValueAndType=(t,o)=>t.type===W.NAME?{value:o[t.value].value,type:o[t.value].type}:{value:t.value,type:t.type},this.evaluate=(t,o,i)=>{if(o.type!==i.type)throw new TypeError("Type for left and right side must be the same. Left: "+o.type+", right: "+i.type);switch(t){case k.LESS_THAN:if(o.type===W.BOOLEAN)throw new TypeError("Boolean expression with operators other than eq not supported.");return o.value<i.value;case k.GREATER_THAN:if(o.type===W.BOOLEAN)throw new TypeError("Boolean expression with operators other than eq not supported.");return o.value>i.value;case k.EQUAL:return o.value===i.value}}}getRepresentation(){const t=this.getOperator(this.node),o=this.scope.outputModel,i=this.node.expression[t];if(void 0===i)throw new Error("Empty DecisionNode");const s=this.getValueAndType(i.left,o),l=this.getValueAndType(i.right,o),d=this.evaluate(t,s,l)?this.node.next:this.node.nextFalse;return{kind:C.SKIP,nodeModel:{nodeId:this.node.nodeName},nextNodeId:d}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-decision-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:0,vars:0,template:function(t,o){}}),n})(),Ut=(()=>{class n{constructor(){}ngOnInit(){}getRepresentation(){return{kind:C.END,nodeModel:{nodeId:this.node.nodeName}}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-end-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:0,vars:0,template:function(t,o){}}),n})();const xt=[{typeName:"bodyCellMass",typeValue:"float",translationId:"BODY_CELL_MASS"},{typeName:"fatMass",typeValue:"float",translationId:"FAT_MASS"},{typeName:"hemoglobin",typeValue:"float",translationId:"HAEMOGLOBIN"},{typeName:"height",typeValue:"integer",translationId:"HEIGHT"},{typeName:"peakFlow",typeValue:"integer",translationId:"PEAK_FLOW"},{typeName:"phaseAngle",typeValue:"float",translationId:"PHASE_ANGLE"},{typeName:"pulse",typeValue:"integer",translationId:"PULSE"},{typeName:"respiratoryRate",typeValue:"integer",translationId:"RESPIRATORY_RATE"},{typeName:"sitToStand",typeValue:"integer",translationId:"SIT_TO_STAND"},{typeName:"temperature",typeValue:"float",translationId:"TEMPERATURE"},{typeName:"temperatureFahrenheit",typeValue:"float",translationId:"TEMPERATURE_FAHRENHEIT"},{typeName:"weight",typeValue:"float",translationId:"WEIGHT"},{typeName:"weightPound",typeValue:"float",translationId:"WEIGHT_POUND"},{typeName:"oxygenFlow",typeValue:"float",translationId:"OXYGEN_FLOW"}];function yt(n,r){1&n&&(e.TgZ(0,"span",8),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"VALUE_INCORRECT_WARNING")))}const Dt=function(n){return{warning:n}};function Rt(n,r){if(1&n&&(e.TgZ(0,"fieldset",4)(1,"div")(2,"label",5),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"input",6),e.YNc(6,yt,3,3,"span",7),e.qZA()()),2&n){const t=r.$implicit,o=r.index,i=e.oxw();e.xp6(2),e.Q6J("for",t.nodeTypeName),e.xp6(1),e.Oqu(e.lcZ(4,8,t.translationId)),e.xp6(2),e.Q6J("id",t.nodeTypeName)("name",t.nodeTypeName)("step",t.formStep)("formControlName",o)("ngClass",e.VKq(10,Dt,i.isOffendingValue(t.nodeTypeName))),e.xp6(1),e.Q6J("ngIf",i.isOffendingValue(t.nodeTypeName))}}let y=(()=>{class n{constructor(t,o){this.formBuilder=t,this.parserUtils=o,this.inputs=[],this.nodeForm=this.formBuilder.group({inputControls:this.formBuilder.array([])}),this.integerRegex="[0-9]+",this.floatRegex="([0-9]*[.,])?[0-9]+",this.getRepresentation=()=>{const i=xt.find(E=>E.typeName===this.parameters.parserTypeName),s=i.typeName,l=i.typeValue,m="integer"===l?this.integerRegex:this.floatRegex;this.inputs.push({nodeTypeName:s,nodeTypeValue:l,translationId:i.translationId,formStep:"integer"===l?"1":"any",formPattern:m}),this.inputControls.push(this.formBuilder.control("",a.kI.compose([a.kI.required,a.kI.pattern(m)])));const c={nodeId:this.node.nodeName,heading:this.node.text,rangeCheck:E=>(E=Object.assign({nodeModel:E},{[s]:this.getValue(s)}),this.parserUtils.checkInputRanges([s],this.node,E))};"comment"in this.node&&(c.comment=this.node.comment);const f={show:!0,text:"NEXT",nextNodeId:this.node.next,validate:E=>!this.nodeForm.invalid,click:E=>{const v=[s],N=this.getValue(s);void 0!==N?(c[s]=N,this.parserUtils.addMeasurementsToOutput(E.outputModel,c,this.node,v),this.parserUtils.addMeasurementCommentToOutput(E.outputModel,c,this.node),this.parserUtils.addManualMeasurementOriginToOutput(E.outputModel,this.node)):console.error(`Variabel in output model for nodeTypeName: '${s}' was undefined`)}},g={kind:C.NODE,nodeModel:c,leftButton:{show:!0,text:"SKIP",nextNodeId:this.node.nextFail},rightButton:f};return this.parserUtils.addHelpMenu(this.node,g),g}}isOffendingValue(t){return this.scope.hasOffendingValue(t)}getIndex(t){const o=this.inputs.findIndex(i=>i.nodeTypeName===t);return o<0||void 0===o?-1:o}getValue(t){const o=this.getIndex(t);let i;return o>=0&&(i=this.inputControls.at(o).value),i}onSubmit(){console.log(this.nodeForm.value)}get inputControls(){return this.nodeForm.get("inputControls")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3),e.Y36(x))},n.\u0275cmp=e.Xpm({type:n,selectors:[["manual-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:5,vars:3,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],["formArrayName","inputControls","class","questionnaire-fields",4,"ngFor","ngForOf"],["formArrayName","inputControls",1,"questionnaire-fields"],[3,"for"],["type","number","autocomplete","off","focusOnLoad","",3,"id","name","step","formControlName","ngClass"],["id","input.nodeTypeName","class","warning",4,"ngIf"],["id","input.nodeTypeName",1,"warning"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.YNc(4,Rt,7,12,"fieldset",3),e.qZA()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(1),e.Q6J("ngForOf",o.inputs))},dependencies:[I.mk,I.sg,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,a.CE,R,M.X$]}),n})();var te=(()=>{return(n=te||(te={})).STATUS="status",n.MEASUREMENT="measurement",te;var n})(),A=(()=>{return(n=A||(A={})).INFO="info",n.ERROR="error",n.PROGRESS="progress",A;var n})();const S={ACTIVITY_TRACKER:{name:"activity tracker",parameters:[],measurementTypeName:"activity",measurementTypes:[{kind:"single",name:"dailySteps",unit:"step count",value:"dailySteps"},{kind:"single",name:"dailyStepsWeeklyAverage",unit:"step count",value:"dailyStepsWeeklyAverage"},{kind:"single",name:"dailyStepsHistoricalMeasurements",unit:"step count",value:"dailyStepsHistoricalMeasurements"}],statusHandlers:{progress:(n,r)=>{"progress"===r.type&&(n.progress=r.progress)}}},BLOOD_PRESSURE_MONITOR:{name:"blood pressure monitor",parameters:[],measurementTypeName:"blood_pressure",measurementTypes:[{kind:"multiple",name:"blood pressure",unit:"mmHg",values:["systolic","diastolic","meanArterialPressure"]},{kind:"single",name:"pulse",unit:"BPM",value:"pulse"}]},ECG:{name:"ecg",parameters:["sampleTimeInSeconds"],measurementTypeName:"ecg",measurementTypes:[{kind:"multiple",name:"ecg",values:["startTime","duration","frequency","rrIntervals","samples"]}],statusHandlers:{progress:(n,r)=>{const t=n;if(r.type==A.PROGRESS){const s=r.progress,l=t.sampleTime;t.progress=((s,l)=>l/s*100)(l,s),t.remaining=((s,l)=>s-l)(l,s)}}}},GLUCOMETER:{name:"glucometer",parameters:[],measurementTypeName:"blood_sugar",measurementTypes:[{kind:"single",name:"blood sugar",unit:"mmol/L",value:"bloodSugarMeasurements"}]},OXIMETER:{name:"oximeter",parameters:[],measurementTypeName:"saturation",measurementTypes:[{kind:"single",name:"saturation",unit:"%",value:"saturation"},{kind:"single",name:"pulse",unit:"BPM",value:"pulse"}]},OXYGEN_FLOW:{name:"oxygen flow",parameters:[],measurementTypeName:"oxygen_flow",measurementTypes:[{kind:"single",name:"oxygenFlow",unit:"L/min",value:"oxygenFlow"}]},OXIMETER_WITHOUT_PULSE:{name:"oximeter",parameters:[],measurementTypeName:"saturation",measurementTypes:[{kind:"single",name:"saturation",unit:"%",value:"saturation"}]},PULSE:{name:"pulse",parameters:[],measurementTypeName:"pulse",measurementTypes:[{kind:"single",name:"pulse",unit:"BPM",value:"pulse"}]},RESPIRATORY_RATE:{name:"respiratory rate",parameters:[],measurementTypeName:"respiratory_rate",measurementTypes:[{kind:"single",name:"respiratoryRate",unit:"RR",value:"respiratoryRate"}]},SPIROMETER:{name:"spirometer",parameters:[],measurementTypeName:"spirometry",measurementTypes:[{kind:"single",name:"fev1",unit:"L",value:"fev1"},{kind:"single",name:"fev6",unit:"L",value:"fev6"},{kind:"single",name:"fev1/fev6",unit:"%",value:"fev1/fev6"},{kind:"single",name:"fef25-75%",unit:"L/s",value:"fef25-75%"}]},THERMOMETER:{name:"thermometer",parameters:[],measurementTypeName:"temperature",measurementTypes:[{kind:"single",name:"temperature",unit:"\xb0C",value:"temperature"}]},WEIGHT_SCALE:{name:"weight scale",parameters:[],measurementTypeName:"weight",measurementTypes:[{kind:"single",name:"weight",unit:"kg",value:"weight"}]}};let Oe=(()=>{class n{constructor(){this.statusEventHandlers=new Map([[A.INFO,(t,o)=>{o.type==A.INFO&&this.setNodeModelValue(t,"info",o.message)}],[A.ERROR,(t,o)=>{o.type==A.ERROR&&this.setNodeModelValue(t,"error",o.message)}],[A.PROGRESS,(t,o)=>{o.type==A.PROGRESS&&this.setNodeModelValue(t,"progress",o.progress)}]]),this.handleStatusEvent=(t,o)=>{const i=o.type,s=this.statusEventHandlers.get(i);void 0!==s?s(t,o):console.warn(`Could not find any status handler for '${i}'`)},this.createMeasurementHandler=t=>{const i=t.measurementTypes.map(s=>{const l=s.name;switch(s.kind){case"single":{const u=s.value;return(m,p)=>p.type===l&&(this.setNodeModelValue(m,u,p.value),!0)}case"multiple":{const u=s.values;return(m,p)=>p.type===l&&(u.forEach(c=>{this.setNodeModelValue(m,c,p.value[c])}),!0)}}});return(s,l)=>{i.some(d=>d(s,l))||console.warn(`MeasurementHandler: could not find handler for event: ${JSON.stringify(l)}`)}},this.overrideStatusEventHandler=(t,o)=>{this.statusEventHandlers.set(t,o)},this.create=(t,o)=>{if(Z(o.statusHandlers)){const s=o.statusHandlers;s[A.INFO]&&this.overrideStatusEventHandler(A.INFO,s[A.INFO]),s[A.ERROR]&&this.overrideStatusEventHandler(A.ERROR,s[A.ERROR]),s[A.PROGRESS]&&this.overrideStatusEventHandler(A.PROGRESS,s[A.PROGRESS])}const i=this.createMeasurementHandler(o);return s=>{switch(console.debug(`Event: ${JSON.stringify(s)}`),s.type){case te.MEASUREMENT:const l=s.measurement;this.setNodeModelValue(t,"origin",s.origin),i(t,l);break;case te.STATUS:this.handleStatusEvent(t,s.status)}}},this.setNodeModelValue=(t,o,i)=>{void 0!==t.setValue&&t.setValue(o,i)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Lt=(()=>{class n{constructor(t,o,i){this.parserUtils=t,this.native=o,this.deviceListenerService=i,this.getMeasurementTypeNames=s=>s.measurementTypes.reduce((d,m)=>d.concat("multiple"===m.kind?m.values:[m.value]),[]),this.generateValidate=s=>l=>{const u=l.representation.nodeModel;return s.reduce((p,c)=>p&&Z(u[c]),!0)},this.generateClickAction=(s,l,u)=>d=>{let m=s.concat(["origin"]);Z(l)&&(m=l(m,d.representation.nodeModel)),this.parserUtils.addMeasurementCommentToOutput(d.outputModel,d.representation.nodeModel,u),this.parserUtils.addMeasurementsToOutput(d.outputModel,d.representation.nodeModel,u,m)},this.generateRepresentationGenerator=(s,l)=>{const u=l.outputMapper,d=this.getMeasurementTypeNames(s);return(p,c)=>{const h={show:!0,text:"SKIP",nextNodeId:p.nextFail},f={show:!0,text:"NEXT",nextNodeId:p.next,validate:this.generateValidate(d),click:this.generateClickAction(d,u,p)};return{kind:C.NODE,nodeModel:c,leftButton:h,rightButton:f}}},this.create=s=>{const l=s.meterType,u=this.generateRepresentationGenerator(l,s);return d=>{const m=s.infoText,p={nodeId:d.nodeName,heading:d.text,progress:0,info:Z(m)?m:"CONNECTING"};"comment"in d&&(p.comment=d.comment);const c=this.deviceListenerService.create(p,l),f={};if(l.parameters.forEach(v=>{v in d&&(f[v]=d[v])}),this.native.subscribeToMultipleMessages("deviceMeasurementResponse",v=>{v.meterType===s.meterType.name&&c(v.event)}),!this.native.addDeviceListener(l.name,f))throw new Error(`Could not add device listener for ${l.name}`);const E=u(d,p);return"helpMenu"in E&&this.parserUtils.addHelpMenu(d,E),E}}}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(x),e.LFG($.R),e.LFG(Oe))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Ce=O(2914);function bt(n,r){if(1&n&&(e.TgZ(0,"div",9),e._UZ(1,"i",10),e.TgZ(2,"div",11)(3,"label",12),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"progress",13),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.AsE("",null==t.nodeModel?null:t.nodeModel.progress,"% ",e.lcZ(5,3,"ACTIVITY_TRACKER_SYNCED_PERCENTAGE"),""),e.xp6(2),e.s9C("value",null==t.nodeModel?null:t.nodeModel.progress)}}function Zt(n,r){1&n&&e._UZ(0,"h1",14)}function wt(n,r){if(1&n&&(e.TgZ(0,"div",15)(1,"h2",14),e._uU(2),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(t.parameters.error)}}function Ft(n,r){if(1&n&&(e.TgZ(0,"div",16)(1,"label",17),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",18),e.qZA()),2&n){const t=r.$implicit,o=r.index,i=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,5,t.translationId)),e.xp6(2),e.Q6J("id",t.key)("name",t.key)("value",i.nodeModel[t.key])("formControlName",o)}}let V=(()=>{class n{constructor(t,o,i,s){this.formBuilder=t,this.deviceNodeParserService=o,this.translate=i,this.applicationRef=s,this.inputs=[],this.nodeForm=this.formBuilder.group({inputControls:this.formBuilder.array([])}),this.nodeModel=void 0,this.error=void 0,this.errorTitle=void 0,this.getRepresentation=()=>{const l=this.deviceNodeParserTypes.find(p=>p.nodeTypeName===this.parameters.nodeTypeName);if(void 0===l)throw this.errorTitle=this.translate.instant("UNSUPPORTED_DEVICE"),this.error=this.parameters.nodeTypeName,new Error(`Could not find AutomaticDeviceNodeParser for ${this.parameters.nodeTypeName}!`);const m=this.deviceNodeParserService.create(l.deviceNodeType)(this.node);this.nodeModel=m.nodeModel,this.nodeModel.setValue=(p,c)=>{void 0!==this.nodeModel&&(this.nodeModel[p]=c,this.applicationRef.tick())};for(const p of l.formInputs)this.inputs.push(p),this.inputControls.push(this.formBuilder.control({value:"",disabled:!0},a.kI.required));return m},this.deviceNodeParserTypes=[{nodeTypeName:_.ACTIVITY_DEVICE_NODE,deviceNodeType:{meterType:S.ACTIVITY_TRACKER,outputMapper:(l,u)=>l},formInputs:[{translationId:"DAILY_STEPS",key:"dailySteps"},{translationId:"DAILY_STEPS_WEEKLY_AVERAGE",key:"dailyStepsWeeklyAverage"}]},{nodeTypeName:_.BLOOD_PRESSURE_DEVICE_NODE,deviceNodeType:{meterType:S.BLOOD_PRESSURE_MONITOR,infoText:"BLOOD_PRESSURE_CONNECT",outputMapper:(l,u)=>l},formInputs:[{translationId:"BLOOD_PRESSURE_SYSTOLIC",key:"systolic"},{translationId:"BLOOD_PRESSURE_DIASTOLIC",key:"diastolic"},{translationId:"BLOOD_PRESSURE_PULSE",key:"pulse"}]},{nodeTypeName:_.BLOOD_SUGAR_DEVICE_NODE,deviceNodeType:{meterType:S.GLUCOMETER,outputMapper:(l,u)=>l},formInputs:[]},{nodeTypeName:_.SATURATION_DEVICE_NODE,deviceNodeType:{meterType:S.OXIMETER,outputMapper:(l,u)=>l},formInputs:[{translationId:"SATURATION_SATURATION",key:"saturation"},{translationId:"SATURATION_PULSE",key:"pulse"}]},{nodeTypeName:_.SATURATION_WITHOUT_PULSE_DEVICE_NODE,deviceNodeType:{meterType:S.OXIMETER,outputMapper:(l,u)=>l},formInputs:[{translationId:"SATURATION_SATURATION",key:"saturation"}]},{nodeTypeName:_.SPIROMETER_DEVICE_NODE,deviceNodeType:{meterType:S.SPIROMETER,outputMapper:(l,u)=>this.isSpirometerNodeModel(u)?(u.fef2575=u["fef25-75%"],u.fev1Fev6Ratio=u["fev1/fev6"],["fev1","fev6","fev1Fev6Ratio","fef2575","origin"]):[]},formInputs:[{translationId:"SPIROMETER_FEV1",key:"fev1"},{translationId:"SPIROMETER_FEV6",key:"fev6"},{translationId:"SPIROMETER_FEV1_FEV6_RATIO",key:"fev1/fev6"},{translationId:"SPIROMETER_FEF25_75",key:"fef25-75%"}]},{nodeTypeName:_.TEMPERATURE_DEVICE_NODE,deviceNodeType:{meterType:S.THERMOMETER,outputMapper:(l,u)=>l},formInputs:[{translationId:"TEMPERATURE",key:"temperature"}]},{nodeTypeName:_.WEIGHT_DEVICE_NODE,deviceNodeType:{meterType:S.WEIGHT_SCALE,outputMapper:(l,u)=>l},formInputs:[{translationId:"WEIGHT",key:"weight"}]},{nodeTypeName:_.OXYGEN_FLOW_DEVICE_NODE,deviceNodeType:{meterType:S.OXYGEN_FLOW,outputMapper:(l,u)=>l},formInputs:[{translationId:"OXYGEN_FLOW",key:"oxygenFlow"}]}]}isSpirometerNodeModel(t){return void 0!==t.fev1&&void 0!==t.fev6&&void 0!==t.fef2575&&void 0!==t.fev1Fev6Ratio}onSubmit(){console.log("automatic-device-node.component.ts->onSubmit"),console.log(this.nodeForm.value)}get inputControls(){return this.nodeForm.get("inputControls")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.qu),e.Y36(Lt),e.Y36(M.sK),e.Y36(e.z2F))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-automatic-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:10,vars:8,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[3,"info","error"],["class","notification progress",4,"ngIf"],["class","line-wrap",4,"ngIf"],["class","content questionnaire_content",4,"ngIf"],["formArrayName","inputControls",1,"questionnaire-fields"],["class","block",4,"ngFor","ngForOf"],[1,"notification","progress"],[1,"notification_icon","fas","fa-play-circle"],["id","progress-container"],["id","progress-label"],["id","progress-bar","max","100",3,"value"],[1,"line-wrap"],[1,"content","questionnaire_content"],[1,"block"],["for","measurement"],["type","number",3,"id","name","value","formControlName"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e._UZ(4,"notifications",3),e.YNc(5,bt,7,5,"div",4),e.YNc(6,Zt,1,0,"h1",5),e.YNc(7,wt,3,1,"div",6),e.TgZ(8,"fieldset",7),e.YNc(9,Ft,5,7,"div",8),e.qZA()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.text),e.xp6(1),e.Q6J("info",null==o.nodeModel?null:o.nodeModel.info)("error",null==o.nodeModel?null:o.nodeModel.error),e.xp6(1),e.Q6J("ngIf",void 0===(null==o.nodeModel?null:o.nodeModel.error)&&o.nodeModel.progress>0),e.xp6(1),e.Q6J("ngIf",o.errorTitle),e.xp6(1),e.Q6J("ngIf",o.error),e.xp6(2),e.Q6J("ngForOf",o.inputs))},dependencies:[I.sg,I.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.sg,a.u,a.CE,Ce.t,M.X$]}),n})();var Me=O(655);function qt(n,r){if(1&n&&(e.TgZ(0,"li",6),e._UZ(1,"input",7),e.TgZ(2,"label",8),e._uU(3),e.qZA()()),2&n){const t=r.$implicit,o=r.index;e.xp6(1),e.MGl("id","radio-",o,""),e.Q6J("value",o),e.xp6(1),e.MGl("for","radio-",o,""),e.xp6(1),e.Oqu(t.text)}}let kt=(()=>{class n{constructor(t){this.formBuilder=t,this.choices=[],this.nodeForm=this.formBuilder.group({selectedIndex:[-1,a.kI.compose([a.kI.required,a.kI.min(0)])]})}getRepresentation(){return((o,i,s)=>{const l={nodeId:o.nodeName,heading:o.question,choices:o.answer.choices};for(const g of l.choices){const v=(0,Me._T)(g,["next"]);this.choices.push(v)}const u=()=>{var g;return null!==(g=this.nodeForm.value.selectedIndex)&&void 0!==g?g:-1},d=function(){const g=u();return l.choices[g]},p=o.nodeName;return Object.assign({kind:C.NODE,nodeModel:l,centerButton:{show:!0,text:"NEXT",click:g=>{const E=o.answer.name,v=o.answer.type,N=o.branchOnChoices?d().next:o.next,U=d();g.model.centerButton.nextNodeId=N,g.outputModel[p]={name:E,type:v,value:U.value}},validate:()=>!this.nodeForm.invalid}},this.nodeForm.value)})(this.node)}onSubmit(){console.log(this.nodeForm.value)}get selectedIndex(){const t=this.nodeForm.get("selectedIndex");if(null===t)throw new Error("No form control for selectedIndex");return t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-multiple-choice-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:8,vars:3,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"radio-list"],["class","narrow-row list-unstyled",4,"ngFor","ngForOf"],[1,"narrow-row","list-unstyled"],["name","selectedIndex","type","radio","formControlName","selectedIndex",3,"id","value"],[1,"radio-label",3,"for"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset",3)(5,"div")(6,"ul",4),e.YNc(7,qt,4,4,"li",5),e.qZA()()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.question),e.xp6(4),e.Q6J("ngForOf",o.choices))},dependencies:[I.sg,a._Y,a.Fj,a._,a.JJ,a.JL,a.sg,a.u]}),n})();function Vt(n,r){if(1&n&&(e.TgZ(0,"li",6),e._UZ(1,"input",7),e.TgZ(2,"label",8),e._uU(3),e.qZA()()),2&n){const t=r.$implicit,o=r.index;e.xp6(1),e.MGl("id","radio-",o,""),e.Q6J("value",o),e.xp6(1),e.MGl("for","radio-",o,""),e.xp6(1),e.Oqu(t.text)}}let Pt=(()=>{class n{constructor(t){this.formBuilder=t,this.choices=[],this.nodeForm=this.formBuilder.group({selectedIndex:[-1,a.kI.compose([a.kI.required,a.kI.min(0)])]})}getRepresentation(){return((o,i,s)=>{const l={nodeId:o.nodeName,heading:o.question,choices:o.answer.choices};for(let h of l.choices){const g=(0,Me._T)(h,["next"]);this.choices.push(g)}const u=()=>{var h;return null!==(h=this.nodeForm.getRawValue().selectedIndex)&&void 0!==h?h:-1};return{kind:C.NODE,nodeModel:l,centerButton:{show:!0,text:"NEXT",nextNodeId:o.next,click:()=>{const h=o.answer.name,f=o.answer.type,g=(h=>{const f=u();return h.choices[f]})(l);s[h]={name:h,type:f,value:g.value}},validate:()=>!this.nodeForm.invalid},selectedIndex:u()}})(this.node,0,this.scope.outputModel)}onSubmit(){console.log(this.nodeForm.value)}get selectedIndex(){return this.nodeForm.get("selectedIndex")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(a.j3))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-multiple-choice-question-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:8,vars:3,consts:[[3,"formGroup","ngSubmit"],[1,"center-div"],[1,"line-wrap","text-element"],[1,"questionnaire-fields"],[1,"radio-list"],["class","narrow-row list-unstyled",4,"ngFor","ngForOf"],[1,"narrow-row","list-unstyled"],["name","selectedIndex","type","radio","formControlName","selectedIndex",3,"id","value"],[1,"radio-label",3,"for"]],template:function(t,o){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"fieldset",3)(5,"div")(6,"ul",4),e.YNc(7,Vt,4,4,"li",5),e.qZA()()()()),2&t&&(e.Q6J("formGroup",o.nodeForm),e.xp6(3),e.Oqu(o.node.question),e.xp6(4),e.Q6J("ngForOf",o.choices))},dependencies:[I.sg,a._Y,a.Fj,a._,a.JJ,a.JL,a.sg,a.u]}),n})(),Bt=(()=>{class n{constructor(){this.calculateSum=(t,o)=>{let i=0;return t.forEach(s=>{i+=o[s].value}),i},this.branchOnSum=(t,o)=>{for(const i of t)if(o>=i.from&&o<=i.to)return i.next;throw new Error("The sum does not fall within any of the specified branches. Error in questionnaire. Sum: "+o)},this.getNextNode=(t,o)=>!0===t.branchOnSum?this.branchOnSum(t.intervals,o):t.next,this.getRepresentation=()=>{const t=this.calculateSum(this.node.questions,this.scope.outputModel),o=this.node.name;this.scope.outputModel[o]={name:o,type:this.node.type,value:t};const s=this.getNextNode(this.node,t);return{kind:C.SKIP,nodeModel:{nodeId:this.node.nodeName},nextNodeId:s}}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-multiple-choice-summation-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:0,vars:0,template:function(t,o){}}),n})(),Qt=(()=>{class n{constructor(t){this.translate=t,this.count=void 0,this.countUp=void 0,this.countTime=void 0,this.onTimerStopped=void 0,this.timerStoppedChange=new e.vpe,this.interval=1e3,this.stopTicking=void 0,this.stopWatching=void 0,this.timerDescription=void 0,this.stopTimer=()=>{this.count=!0===this.countUp?0:this.countTime,this.stopTicking&&(clearInterval(this.stopTicking),this.stopTicking=void 0)},this.nextNode=()=>{this.stopTimer(),this.timerStoppedChange.emit(void 0)},this.updateDescription=()=>{let o=this.translate.instant("DELAY_NODE_DESCRIPTION_LEFT_DOWN");const i=this.translate.instant("DELAY_NODE_DESCRIPTION_CENTER"),s=this.translate.instant("DELAY_NODE_DESCRIPTION_RIGHT");!0===this.countUp&&(o=this.translate.instant("DELAY_NODE_DESCRIPTION_LEFT_UP")),this.timerDescription=o+" "+this.count+" "+i+" "+this.countTime+" "+s},this.tick=()=>{if(!0===this.countUp){if(this.count++,this.updateDescription(),this.count>=this.countTime)return this.nextNode()}else if(this.count--,this.updateDescription(),this.count<=0)return this.nextNode()}}ngOnChanges(t){void 0===t.count.currentValue&&(this.stopTimer(),this.stopWatching()),this.updateDescription(),this.stopTicking=setInterval(()=>this.tick(),this.interval,this.countTime)}ngOnDestroy(){console.debug("Timer component onDestroy"),this.stopTicking&&(clearInterval(this.stopTicking),this.stopTicking=void 0)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(M.sK))},n.\u0275cmp=e.Xpm({type:n,selectors:[["timer"]],inputs:{count:"count",countUp:"countUp",countTime:"countTime",onTimerStopped:"onTimerStopped"},outputs:{timerStoppedChange:"timerStoppedChange"},features:[e.TTD],decls:3,vars:1,consts:[[1,"center-div"],[1,"line-wrap","text-element"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.qZA()()),2&t&&(e.xp6(2),e.Oqu(o.timerDescription))}}),n})(),Gt=(()=>{class n{onTimerStopped(){this.scope.nextNode(this.node.next,this.nodeMap)}getRepresentation(){return((o,i,s)=>(this.nodeModel={nodeId:o.nodeName,heading:o.displayTextString,count:o.countUp?0:o.countTime,countTime:o.countTime,countUp:o.countUp,onTimerStopped:this.onTimerStopped},{kind:C.NODE,nodeModel:this.nodeModel,centerButton:{show:!0,text:"NEXT",validate:()=>!1}}))(this.node)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-delay-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:4,vars:4,consts:[[1,"center-div"],[1,"line-wrap","text-element"],[3,"count","countUp","countTime","timerStoppedChange"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.qZA()(),e.TgZ(3,"timer",2),e.NdJ("timerStoppedChange",function(){return o.onTimerStopped()}),e.qZA()),2&t&&(e.xp6(2),e.Oqu(null==o.nodeModel?null:o.nodeModel.heading),e.xp6(1),e.Q6J("count",null==o.nodeModel?null:o.nodeModel.count)("countUp",null==o.nodeModel?null:o.nodeModel.countUp)("countTime",null==o.nodeModel?null:o.nodeModel.countTime))},dependencies:[Qt]}),n})(),fe=(()=>{class n{constructor(t,o){this.router=t,this.translate=o,this.title="Oops...",this.error=""}getRepresentation(){var t,o,i,s,l;if((null===(t=this.parameters)||void 0===t?void 0:t.nodeTypeName)&&(null===(o=this.parameters)||void 0===o?void 0:o.noNative))this.error=this.translate.instant("NO_NATIVE_LAYER").replace("{0}",this.parameters.nodeTypeName);else if((null===(i=this.parameters)||void 0===i?void 0:i.type)&&(null===(s=this.parameters)||void 0===s?void 0:s.nodeTypeName))switch(null===(l=this.parameters)||void 0===l?void 0:l.type){case q.AUTOMATIC:this.error=this.translate.instant("AUTOMATIC_DEVICE_NOT_SUPPORTED").replace("{0}",this.parameters.nodeTypeName);break;case q.MANUAL:this.error=this.translate.instant("MANUAL_DEVICE_NOT_SUPPORTED").replace("{0}",this.parameters.nodeTypeName);break;default:this.error=this.translate.instant("DEVICE_NOT_SUPPORTED").replace("{0}",this.parameters.nodeTypeName)}else this.error=`${this.translate.instant("UNKNOWN")} ${this.translate.instant("ERROR_TITLE")}`;return{kind:C.UNSUPPORTED,nodeModel:{nodeId:"unsupported-node"},centerButton:{show:!0,text:"OK",click:()=>{this.router.navigate(["/menu"])},validate:()=>!0,nextNodeId:C.UNSUPPORTED}}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.F0),e.Y36(M.sK))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-unsupported-node"]],inputs:{node:"node",nodeMap:"nodeMap",scope:"scope",parameters:"parameters"},decls:5,vars:2,consts:[[1,"container"],[3,"title"],[1,"center-div"],[1,"line-wrap","text-element"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"header-menu",1),e.TgZ(2,"div",2)(3,"h2",3),e._uU(4),e.qZA()()()),2&t&&(e.xp6(1),e.Q6J("title",o.title),e.xp6(3),e.Oqu(o.error))},dependencies:[X.G]}),n})();var Jt=O(7166);function Yt(n,r){if(1&n&&(e.TgZ(0,"label",9),e._uU(1),e.ALo(2,"number"),e.ALo(3,"translate"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.AsE(" ",e.xi3(2,2,t.nodeModel.remaining/60,"1.0-0")," ",e.lcZ(3,5,"ECG_MINUTES_LEFT")," ")}}function Ht(n,r){if(1&n&&(e.TgZ(0,"label",9),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.AsE(" ",t.nodeModel.remaining," ",e.lcZ(2,2,"ECG_SECONDS_LEFT")," ")}}function Wt(n,r){if(1&n&&(e.TgZ(0,"div",4),e._UZ(1,"i",5),e.TgZ(2,"div",6),e.YNc(3,Yt,4,7,"label",7),e.YNc(4,Ht,3,4,"label",7),e._UZ(5,"progress",8),e.qZA()()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.nodeModel.remaining>60),e.xp6(1),e.Q6J("ngIf",t.nodeModel.remaining<=60),e.xp6(1),e.s9C("value",t.nodeModel.progress)}}let Kt=(()=>{class n{constructor(t,o,i,s,l){this.parserUtils=t,this.idle=o,this.native=i,this.deviceListener=s,this.applicationRef=l,this.node=void 0,this.nodeMap=void 0,this.outputModel=void 0,this.nodeModel=void 0,this.generateRepresentation=(u,d)=>{const m={text:"SKIP",nextNodeId:u.nextFail},c=(()=>({text:"NEXT",nextNodeId:u.next,validate:E=>{if("samples"in this.nodeModel){const v=this.nodeModel;return Z(v.startTime)&&Z(v.duration)&&Z(v.frequency)&&Z(v.rrIntervals)&&Z(v.samples)}return!1},click:E=>{this.startIdleWatcher(),this.parserUtils.addMeasurementsToOutput(E.outputModel,d,u,["startTime","duration","frequency","rrIntervals","samples","origin"]),this.parserUtils.addMeasurementCommentToOutput(E.outputModel,d,u)}}))();return{nodeModel:d,leftButton:m,rightButton:c}}}getRepresentation(){const t=this.node.sampleTimeInSeconds;this.nodeModel={heading:this.node.text,comment:this.node.comment,info:"CONNECTING",sampleTime:t,remaining:t,progress:0},this.nodeModel.setValue=(m,p)=>{void 0!==this.nodeModel&&(this.nodeModel[m]=p,this.applicationRef.tick())};const o=S.ECG,i=Object.freeze({sampleTimeInSeconds:t}),s=this.deviceListener.create(this.nodeModel,o);if(!this.native.addDeviceListener(o.name,i))throw new Error(`Could not add device listener for ${o.name}`);this.native.subscribeToMultipleMessages("deviceMeasurementResponse",m=>{m.meterType===o.name&&void 0!==m.event&&s(m.event)}),this.idle.stop();const d=this.generateRepresentation(this.node,this.nodeModel);return this.parserUtils.addHelpMenu(this.node,d),d}startIdleWatcher(){this.idle.isRunning()||this.idle.watch()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x),e.Y36(Jt.hX),e.Y36($.R),e.Y36(Oe),e.Y36(e.z2F))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-ecg-device-node"]],inputs:{node:"node",nodeMap:"nodeMap",outputModel:"outputModel"},decls:6,vars:6,consts:[[1,"center-div"],[1,"line-wrap","text-element"],[3,"info","error"],["class","notification progress",4,"ngIf"],[1,"notification","progress"],[1,"notification_icon","fas","fa-play-circle"],["id","progress-container"],["id","progress-label",4,"ngIf"],["id","progress-bar","max","100",3,"value"],["id","progress-label"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.ALo(3,"translate"),e.qZA()(),e._UZ(4,"notifications",2),e.YNc(5,Wt,6,3,"div",3)),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,4,o.nodeModel.heading)," "),e.xp6(2),e.Q6J("info",o.nodeModel.info)("error",o.nodeModel.error),e.xp6(1),e.Q6J("ngIf",void 0===(null==o.nodeModel?null:o.nodeModel.error)))},dependencies:[I.O5,Ce.t,I.JJ,M.X$]}),n})(),jt=(()=>{class n{constructor(t,o){this.parserUtils=t,this.native=o,this.validate=i=>{const s=[],l=[];for(const u in i)i.hasOwnProperty(u)&&l.push(i[u]);if(0===l.length)throw new TypeError("Questionnaire Node list was empty.");if(l.forEach(u=>{const d=this.parserUtils.getNodeTypeName(u);this.hasParser(d)||s.push(d)}),s.length>0)throw new TypeError(`The following Node types are not supported: ${s}`)}}getComponent(t,o,i,s){console.debug(`getComponent: ${t}`);const l=this.native.isAvailable();if(Object.values(z).includes(t)&&!l)return console.error(`No native available for the automatic device node: ${t}`),new T(fe,o,i,s,{type:q.AUTOMATIC,nodeTypeName:t,noNative:"true"});switch(t){case _.ACTIVITY_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.ACTIVITY_TRACKER.name,nodeTypeName:t});case _.BLOOD_PRESSURE_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.BLOOD_PRESSURE_MONITOR.name,nodeTypeName:t});case _.BLOOD_SUGAR_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.GLUCOMETER.name,nodeTypeName:t});case _.SATURATION_DEVICE_NODE:case _.SATURATION_WITHOUT_PULSE_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.OXIMETER.name,nodeTypeName:t});case _.SPIROMETER_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.SPIROMETER.name,nodeTypeName:t});case _.TEMPERATURE_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.THERMOMETER.name,nodeTypeName:t});case _.WEIGHT_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.WEIGHT_SCALE.name,nodeTypeName:t});case _.OXYGEN_FLOW_DEVICE_NODE:return new T(V,o,i,s,{meterTypeName:S.OXYGEN_FLOW.name,nodeTypeName:t});case _.ECG_DEVICE_NODE:return new T(Kt,o,i,s,{});case _.BLOOD_SUGAR_MGDL_DEVICE_NODE:case _.FEMOM_DEVICE_NODE:case _.PULSE_DEVICE_NODE:case _.RESPIRATORY_RATE_DEVICE_NODE:case _.TEMPERATURE_FAHRENHEIT_DEVICE_NODE:case _.WEIGHT_POUND_DEVICE_NODE:return new T(fe,o,i,s,{type:q.AUTOMATIC,nodeTypeName:t});case _.ACTIVITY_MANUAL_DEVICE_NODE:return new T(We,o,i,s,{});case _.BLOOD_SUGAR_MANUAL_DEVICE_NODE:return new T(tt,o,i,s,{});case _.BLOOD_SUGAR_MGDL_MANUAL_DEVICE_NODE:return new T(it,o,i,s,{});case _.BLOOD_PRESSURE_MANUAL_DEVICE_NODE:return new T($e,o,i,s,{});case _.PEAK_FLOW_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"peakFlow"});case _.PULSE_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"pulse"});case _.RESPIRATORY_RATE_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"respiratoryRate"});case _.SIT_TO_STAND_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"sitToStand"});case _.TEMPERATURE_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"temperature"});case _.TEMPERATURE_FAHRENHEIT_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"temperatureFahrenheit"});case _.WEIGHT_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"weight"});case _.WEIGHT_POUND_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"weightPound"});case _.OXYGEN_FLOW_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"oxygenFlow"});case _.HEIGHT_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"height"});case _.BODY_CELL_MASS_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"bodyCellMass"});case _.FAT_MASS_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"fatMass"});case _.PHASE_ANGLE_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"phaseAngle"});case _.PAIN_SCALE_MANUAL_DEVICE_NODE:return new T(ht,o,i,s,{});case _.CRP_MANUAL_DEVICE_NODE:return new T(at,o,i,s,{});case _.SATURATION_MANUAL_DEVICE_NODE:return new T(gt,o,i,s,{});case _.SATURATION_WITHOUT_PULSE_MANUAL_DEVICE_NODE:return new T(Tt,o,i,s,{});case _.SPIROMETER_MANUAL_DEVICE_NODE:return new T(Mt,o,i,s,{});case _.HEMOGLOBIN_MANUAL_DEVICE_NODE:return new T(y,o,i,s,{parserTypeName:"hemoglobin"});case _.URINE_MANUAL_DEVICE_NODE:return new T(ee,o,i,s,{parserTypeName:"urine"});case _.GLUCOSE_URINE_MANUAL_DEVICE_NODE:return new T(ee,o,i,s,{parserTypeName:"glucoseUrine"});case _.BLOOD_URINE_MANUAL_DEVICE_NODE:return new T(ee,o,i,s,{parserTypeName:"bloodUrine"});case _.LEUKOCYTES_URINE_MANUAL_DEVICE_NODE:return new T(ee,o,i,s,{parserTypeName:"leukocytesUrine"});case _.NITRITE_URINE_MANUAL_DEVICE_NODE:return new T(ee,o,i,s,{parserTypeName:"nitriteUrine"});case _.MULTIPLE_CHOICE_NODE:return new T(kt,o,i,s,{});case _.MULTIPLE_CHOICE_QUESTION_NODE:return new T(Pt,o,i,s,{});case _.MULTIPLE_CHOICE_SUMMATION_NODE:return new T(Bt,o,i,s,{});case _.DELAY_NODE:return new T(Gt,o,i,s,{});case _.IO_NODE:return new T(mt,o,i,s,{});case _.ASSIGNMENT_NODE:return new T(At,o,i,s,{});case _.DECISION_NODE:return new T(St,o,i,s,{});case _.END_NODE:return new T(Ut,o,i,s,{});default:return console.error(`Unable to get component of nodeType: ${t}`),new T(fe,o,i,s,{type:q.UNKNOWN,nodeTypeName:t})}}getNode(t,o){const i=o[t],s=this.parserUtils.getNodeTypeName(i);if(!this.hasParser(s))throw new TypeError(`Node of type ${s} not supported`);return{nodeToParse:i,nodeTypeName:s}}hasParser(t){return Object.values(_).includes(t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(x),e.LFG($.R))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Ae=O(9797);function Xt(n,r){if(1&n&&(e.TgZ(0,"div")(1,"h2",16),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"h3",16),e._uU(5),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,2,"OPENTELE_RUNTIME_ERROR")," "),e.xp6(3),e.hij(" ",t.model.error," ")}}function $t(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.model.showHideHelpMenu())}),e._UZ(1,"i",18),e.qZA()}}function zt(n,r){}function en(n,r){1&n&&e._UZ(0,"object",27)}function tn(n,r){if(1&n&&(e._UZ(0,"img",28),e.ALo(1,"translate")),2&n){const t=e.oxw(2);e.s9C("alt",e.lcZ(1,2,"QUESTIONNAIRE_HELP_IMAGE_ARIA")),e.Q6J("src",t.model.helpMenu.imageSrc,e.LSH)}}function nn(n,r){if(1&n&&e._UZ(0,"div",29),2&n){const t=e.oxw(2);e.Q6J("innerHTML",t.model.helpMenu.text,e.oJD)}}function on(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",19)(1,"div",20)(2,"h1",21),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.YNc(5,en,1,0,"object",22),e.YNc(6,tn,2,4,"img",23),e.YNc(7,nn,1,1,"div",24),e.qZA(),e.TgZ(8,"div",12)(9,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.model.showHideHelpMenu())}),e._uU(10),e.ALo(11,"translate"),e._UZ(12,"i",26),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,5,"HELP_INFO")),e.xp6(2),e.Q6J("ngIf",(null==t.model.helpMenu?null:t.model.helpMenu.image)&&!1===(null==t.model.helpMenu?null:t.model.helpMenu.imageLoaded)),e.xp6(1),e.Q6J("ngIf",(null==t.model.helpMenu?null:t.model.helpMenu.image)&&!0===(null==t.model.helpMenu?null:t.model.helpMenu.imageLoaded)),e.xp6(1),e.Q6J("ngIf",null==t.model||null==t.model.helpMenu?null:t.model.helpMenu.text),e.xp6(3),e.hij(" ",e.lcZ(11,7,"OK")," ")}}function sn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",30)(1,"div",31)(2,"div")(3,"h1",32),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"h1"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"div",33)(10,"textarea",34,35),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.model.commentPrompt.text=i)}),e.qZA()()(),e.TgZ(12,"div",12)(13,"button",36),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.model.commentPrompt.confirm())}),e._uU(14),e.ALo(15,"translate"),e._UZ(16,"i",26),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,4,"COMMENT")),e.xp6(3),e.Oqu(e.lcZ(8,6,"COMMENT_PROMPT_INFO")),e.xp6(3),e.Q6J("ngModel",t.model.commentPrompt.text),e.xp6(4),e.hij(" ",e.lcZ(15,8,"OK")," ")}}function rn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(null==i.model.leftButton.click?null:i.model.leftButton.click(i))}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",38),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.model.leftButton.validate&&!t.model.leftButton.validate(t)),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.model.leftButton.text)," ")}}function an(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(null==i.model.rightButton.click?null:i.model.rightButton.click(i))}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",40),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.model.centerButton.validate&&!t.model.centerButton.validate(t)),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.model.centerButton.text)," ")}}function ln(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(null==i.model.rightButton.click?null:i.model.rightButton.click(i))}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",26),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.model.rightButton.validate&&!t.model.rightButton.validate(t)||t.model.confirmTimeout),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.model.rightButton.text)," ")}}let un=(()=>{class n{constructor(t,o,i,s,l,u,d,m,p){this.appContext=t,this.utils=o,this.questionnaires=i,this.native=s,this.translate=l,this.router=u,this.nodesParserService=d,this.componentFactoryResolver=m,this.sanitizer=p,this.model={title:"",state:"Loading",error:void 0,submitNodeForm:()=>{},commentPrompt:{visible:!1,confirm:()=>{}},showHelpMenuIcon:!1,showHideHelpMenu:()=>{},leftButton:{show:!1,text:"",nextNodeId:"",validate:()=>!1,click:()=>{}},centerButton:{show:!1,text:"",nextNodeId:"",validate:()=>!1,click:()=>{}},rightButton:{show:!1,text:"",nextNodeId:"",validate:()=>!1,click:()=>{}}},this.outputModel={},this.nodeMap={},this.nodeHistory=[],this.representation={kind:C.NODE,nodeModel:{nodeId:"placeholder"}},this.loadComponent=(c,h)=>{const{nodeToParse:f,nodeTypeName:g}=this.nodesParserService.getNode(c,h),E=this.nodesParserService.getComponent(g,f[g],h,this),v=this.nodeHost.viewContainerRef;v.clear();const N=this.componentFactoryResolver.resolveComponentFactory(E.component),U=v.createComponent(N);U.instance.node=E.node,U.instance.nodeMap=E.nodeMap,U.instance.scope=E.scope,U.instance.parameters=E.parameters,this.nodeForm=U.instance.nodeForm;const D=U.instance.getRepresentation();return D.kind===C.SKIP?this.loadComponent(D.nextNodeId,this.nodeMap):(this.representation=D,D)},this.forEachButtonDo=c=>{["leftButton","centerButton","rightButton"].forEach(c)},this.setInitialNodeState=()=>{this.forEachButtonDo(c=>{this.model[c]={show:!1,text:"",nextNodeId:"",validate:()=>!0,click:()=>({})}}),this.utils.exists(this.nodeForm)&&this.nodeForm.markAsPristine()},this.collectOutputs=()=>{const c=[];for(const h in this.outputModel)h in this.outputModel&&c.push(this.outputModel[h]);return c},this.renderNode=(c,h)=>{const f=N=>()=>!this.utils.exists(N)||N(this),g=(N,U)=>{const D=U.click,Q=U.validate,ne="nodeModel"in this.representation?this.representation.nodeModel.comment:void 0;return()=>{if(!this.utils.exists(Q)||this.utils.exists(Q)&&Q(this)){this.native.removeDeviceListeners()||console.log("Couldn't remove device listener due to missing native layer");const J=c.nodeModel,De=()=>{D&&D(this),J.offendingValues=void 0,this.nextNode(this.model[N].nextNodeId,h)};(()=>"rightButton"!=N||this.utils.exists(J.offendingValues)?(J.offendingValues=[],!1):this.utils.exists(J.rangeCheck)?(J.offendingValues=J.rangeCheck(c.nodeModel),J.offendingValues.length>0):(J.offendingValues=[],!1))()?(this.model.rightButton.text=this.translate.instant("CONFIRM"),this.model.confirmTimeout=!0,setTimeout(()=>{this.model.confirmTimeout=!1},3e3)):this.utils.exists(ne)?this.renderCommentPrompt(ne,De):De()}}},E=N=>{this.model[N].show=!0,this.model[N].text=this.translate.instant(this.representation[N].text),this.model[N].nextNodeId=this.representation[N].nextNodeId,this.model[N].validate=f(this.representation[N].validate),this.model[N].click=g(N,this.representation[N])};this.forEachButtonDo(N=>{N in this.representation&&E(N)}),this.model.submitNodeForm=()=>{this.model.rightButton.show&&this.model.rightButton.click?this.model.rightButton.click(this):this.model.centerButton.show&&this.model.centerButton.click&&this.model.centerButton.click(this)},(N=>{if("helpMenu"in this.representation){N.showHelpMenuIcon=!0;const U=this.representation.helpMenu;N.helpMenu=U,N.helpMenu.visible=!1,N.helpMenu.imageLoaded=!1,void 0!==U.image&&this.questionnaires.getHelpImage({imageUrl:U.image}).then(D=>{void 0!==N.helpMenu&&(N.helpMenu.imageLoaded=!0,N.helpMenu.imageSrc=this.sanitizer.bypassSecurityTrustResourceUrl(`data:image/png;charset=utf-8;base64,${D}`))}).catch(D=>{console.error(`Could not load help image due to error: ${D}`)})}else N.showHelpMenuIcon=!1,delete N.helpMenu;N.showHideHelpMenu=()=>{N.helpMenu.visible=!this.utils.exists(N.helpMenu)||!N.helpMenu.visible}})(this.model),console.log("Done renderNode"),console.log(this.model)},this.refreshModel=(c,h)=>{console.log("refreshModel");const f=this.loadComponent(c,h);if(this.setInitialNodeState(),f.kind==C.END){const g={outputs:this.collectOutputs(),questionnaire:this.currentQuestionnaire,questionnaireRef:this.questionnaireRef,nodeHistory:this.nodeHistory,outputModel:this.outputModel};this.appContext.requestParams.set(_e,g);const E=this.appContext.requestParams.get("questionnaireId");this.router.navigate(["questionnaires",E,"send_reply"])}else this.renderNode(f,h)},this.renderCommentPrompt=(c,h)=>{this.model.commentPrompt={visible:!0,text:"",confirm:()=>{var f;let g=null===(f=this.model.commentPrompt)||void 0===f?void 0:f.text;g=this.utils.exists(g)?g.trim():"",c.text=g,this.model.commentPrompt.visible=!1,h()}}},this.refreshFromHistory=c=>{const h=this.nodeHistory;this.clearOutputFromHistory(h,this.outputModel,c),0===h.length?globalThis.history.back():this.refreshModel(h[h.length-1],c)},this.clearOutputFromHistory=(c,h,f)=>{const g=c.pop();if(!this.utils.exists(g))return;let E=f[g];for(;"AssignmentNode"in E;){const v=E.AssignmentNode;delete h[v.variable.name],E=f[v.next]}},this.hasOffendingValue=c=>this.utils.exists(this.representation.nodeModel.offendingValues)&&this.representation.nodeModel.offendingValues.indexOf(c)>=0,this.nextNode=(c,h)=>{this.nodeHistory.push(c),c!==C.UNSUPPORTED?this.refreshModel(c,h):console.debug(`NodeId specified as ${C.UNSUPPORTED}. Returning`)},this.toNodeMap=c=>{const f={};return c.forEach(g=>{const E=(g=>{for(const E in g)if(Object.prototype.hasOwnProperty.call(g,E))return E})(g);void 0!==E&&(f[g[E].nodeName]=g)}),f},this.onSuccess=c=>{this.model.state="Loaded",this.currentQuestionnaire=c,this.model.title=this.currentQuestionnaire.name,this.nodeMap=this.toNodeMap(c.nodes);const h=c.startNode;if(this.nodesParserService.validate(this.nodeMap),this.appContext.requestParams.containsKey(_e)){const f=this.appContext.requestParams.getAndClear(_e);this.nodeHistory=f.nodeHistory,this.outputModel=f.outputModel,this.refreshFromHistory(this.nodeMap)}else this.nextNode(h,this.nodeMap)},this.onError=c=>{this.model.state="Failed",console.error(`Failed to load questionnaire due to error: ${c}`),this.model.error=c.message,this.model.centerButton={show:!0,text:"OK",validate:()=>!0},this.model.rightButton.click=()=>{this.router.navigate(["/menu"])}},this.goBack=()=>{this.native.removeDeviceListeners()||console.debug("Couldn't remove device listener due to missing native layer"),this.refreshFromHistory(this.nodeMap)},this.goHome=()=>{this.native.removeDeviceListeners()||console.debug("Couldn't remove device listener due to missing native layer"),this.router.navigate(["/menu"])}}ngOnInit(){this.appContext.requestParams.containsKey(Se)?(this.questionnaireRef=this.appContext.requestParams.getAndClear(Se),this.questionnaires.get(this.questionnaireRef).then(t=>this.onSuccess(t)).catch(t=>this.onError(t))):this.router.navigate(["/menu"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(K.P),e.Y36(j.c),e.Y36(ie),e.Y36($.R),e.Y36(M.sK),e.Y36(w.F0),e.Y36(jt),e.Y36(e._Vd),e.Y36(ve.H7))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-questionnaire"]],viewQuery:function(t,o){if(1&t&&e.Gf(Te,7),2&t){let i;e.iGM(i=e.CRH())&&(o.nodeHost=i.first)}},decls:16,vars:17,consts:[[1,"container"],[3,"showBackBtn","onBackFun","showHomeBtn","onHomeFun","title"],[3,"stateModel","hasNoData","noDataMessage","loadingMessage","failedMessage"],[1,"content"],[4,"ngIf"],["id","nodeForm","name","nodeForm",1,"questionnaire_form",3,"ngSubmit"],["nodeForm","ngForm"],["id","help-button","type","button","class","button help-button",3,"click",4,"ngIf"],["id","questionnaire_content",1,"questionnaire_content"],["nodeHost",""],["id","help-menu","class","overlay space_between",4,"ngIf"],["id","comment-prompt","class","overlay space_between",4,"ngIf"],["id","footer",1,"flex-column"],["id","question-left-button","class","footer-button left-button",3,"disabled","click",4,"ngIf"],["id","question-center-button","class","footer-button center-button","type","submit","form","nodeForm",3,"disabled","click",4,"ngIf"],["id","question-right-button","class","footer-button right-button","type","submit",3,"disabled","click",4,"ngIf"],[1,"line-wrap","text-element"],["id","help-button","type","button",1,"button","help-button",3,"click"],["aria-hidden","true",1,"fal","fa-question-circle"],["id","help-menu",1,"overlay","space_between"],["id","help-content"],["id","help-heading"],["data","../../images/image-loader.svg","type","image/svg+xml",4,"ngIf"],["id","help-image",3,"src","alt",4,"ngIf"],["id","help-text","class","center-div",3,"innerHTML",4,"ngIf"],["id","help-ok-button","type","button",1,"footer-button","center-button",3,"click"],["aria-hidden","true",1,"icon","fas","fa-check-circle"],["data",e.$Z9`../../images/image-loader.svg`,"type","image/svg+xml"],["id","help-image",3,"src","alt"],["id","help-text",1,"center-div",3,"innerHTML"],["id","comment-prompt",1,"overlay","space_between"],["id","comment-content"],["id","comment-heading"],["id","comment-field"],["id","measurement-comment","name","measurement-comment","max-length","300",3,"ngModel","ngModelChange"],["comment","ngModel"],["id","comment-ok-button","type","button",1,"footer-button","center-button",3,"click"],["id","question-left-button",1,"footer-button","left-button",3,"disabled","click"],["aria-hidden","true",1,"icon","fas","fa-times-circle"],["id","question-center-button","type","submit","form","nodeForm",1,"footer-button","center-button",3,"disabled","click"],["aria-hidden","true",1,"icon","fas","fa-arrow-circle-right"],["id","question-right-button","type","submit",1,"footer-button","right-button",3,"disabled","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"header-menu",1)(2,"loading-state",2),e.TgZ(3,"div",3),e.YNc(4,Xt,6,4,"div",4),e.TgZ(5,"form",5,6),e.NdJ("ngSubmit",function(){return o.model.submitNodeForm()}),e.YNc(7,$t,2,0,"button",7),e.TgZ(8,"div",8),e.YNc(9,zt,0,0,"ng-template",9),e.qZA()(),e.YNc(10,on,13,9,"div",10),e.YNc(11,sn,17,10,"div",11),e.qZA(),e.TgZ(12,"div",12),e.YNc(13,rn,4,4,"button",13),e.YNc(14,an,4,4,"button",14),e.YNc(15,ln,4,4,"button",15),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("showBackBtn",!0)("onBackFun",o.goBack)("showHomeBtn",!0)("onHomeFun",o.goHome)("title",o.model.title),e.xp6(1),e.Q6J("stateModel",o.model.state)("hasNoData",!1)("noDataMessage","")("loadingMessage","QUESTIONNAIRE_LOADING")("failedMessage","QUESTIONNAIRE_FAILED"),e.xp6(2),e.Q6J("ngIf","Failed"===o.model.state&&o.model.error),e.xp6(3),e.Q6J("ngIf",o.model.showHelpMenuIcon),e.xp6(3),e.Q6J("ngIf",null==o.model||null==o.model.helpMenu?null:o.model.helpMenu.visible),e.xp6(1),e.Q6J("ngIf",null==o.model||null==o.model.commentPrompt?null:o.model.commentPrompt.visible),e.xp6(2),e.Q6J("ngIf",o.model.leftButton.show),e.xp6(1),e.Q6J("ngIf",o.model.centerButton.show),e.xp6(1),e.Q6J("ngIf",o.model.rightButton.show))},dependencies:[I.O5,X.G,a._Y,a.Fj,a.JJ,a.JL,a.On,a.F,Ae.X,Te,M.X$]}),n})();const _e="questionnaireState",Se="selectedQuestionnaire";var dn=O(737),ge=O(8405),cn=O(5439),de=O.n(cn),pn=O(8288);function mn(n,r){if(1&n&&(e.TgZ(0,"span",10),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.scheduleWindow.end," ")}}const hn=function(n,r){return{important_list_item:n,normal_list_item:r}};function fn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"a",6),e.NdJ("click",function(){const s=e.CHM(t).index,l=e.oxw();return e.KtG(l.showQuestionnaire(s))}),e.TgZ(1,"div",7)(2,"span",8),e._uU(3),e.qZA(),e.YNc(4,mn,2,1,"span",9),e.qZA()()}if(2&n){const t=r.$implicit;e.hYB("id","",t.name," ",t.version,""),e.Q6J("ngClass",e.WLB(5,hn,null==t.scheduleWindow?null:t.scheduleWindow.open,!(null!=t.scheduleWindow&&t.scheduleWindow.open))),e.xp6(3),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf",t.scheduleWindow)}}function _n(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",11)(1,"button",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.goOtherQuestionnaires())}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"OTHER_QUESTIONNAIRES")," "))}let gn=(()=>{class n{constructor(t,o,i,s,l,u,d){this.appContext=t,this.utils=o,this.questionnaires=i,this.questionnaireSchedules=s,this.translate=l,this.router=u,this.clinician=d,this.model={state:"Loading",questionnaires:[]},this.isClinician=!1,this.receivedQuestionnaires=p=>{const c=p.results;this.model.questionnaires=c.map(f=>Object.assign(Object.assign({},f),{marked:!1})),this.model.state="Loaded",1===c.length&&!this.isClinician&&this.showQuestionnaire(0),this.questionnaireSchedules.list(this.user,!1).subscribe(f=>{this.model.questionnaires=this.model.questionnaires.map(E=>{const v=f.find(G=>E.name===G.name);if(!this.utils.exists(v)||!this.utils.exists(v.nextDeadline)||!this.utils.exists(v.scheduleWindowStart))return E;const N=v.nextDeadline,U=v.scheduleWindowStart,D=(0,dn.Z)(N,1),Q=new Date;if(Q<D)return E;const ne=G=>de()(G).format("LT");if((0,ge.Z)(U,N)){if((0,ge.Z)(Q,N)){const G=this.translate.instant("TODAY")+", "+ne(N);return E.scheduleWindow={end:G,open:!0},E}return E.scheduleWindow={end:de()(N).format("ddd"),open:!1},E}if(Q<=U)return E.scheduleWindow={end:de()(N).format("ddd"),open:!1},E;if((0,ge.Z)(Q,N)){const G=this.translate.instant("TODAY")+", "+ne(N);return E.scheduleWindow={end:G,open:!0},E}return E.scheduleWindow={end:de()(N).format("ddd, LT"),open:!0},E})})},this.onError=p=>{this.model.state="Failed",console.error(`Failed to load questionnaires due to error: ${p}`)};const m=this.appContext.getUser();if(void 0===m)throw this.model.state="Failed",new TypeError("No current user");this.user=m,this.isClinician=this.clinician.isClinician()}ngOnInit(){this.questionnaires.list(this.user).then(t=>this.receivedQuestionnaires(t)).catch(t=>this.onError(t))}showQuestionnaire(t){const o=this.model.questionnaires[t];o.marked=!1,this.appContext.requestParams.set("selectedQuestionnaire",o),this.appContext.requestParams.set("questionnaireId",t),this.isClinician?this.router.navigate(["questionnaires",t,"questionnaire"]):this.router.navigate(["questionnaires",t,"questionnaire"],1===this.model.questionnaires.length?{replaceUrl:!0}:{})}goOtherQuestionnaires(){this.router.navigate(["questionnaires/other_questionnaires"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(K.P),e.Y36(j.c),e.Y36(ie),e.Y36(pn.t),e.Y36(M.sK),e.Y36(w.F0),e.Y36(ce.N))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-questionnaires"]],decls:6,vars:10,consts:[[1,"container"],[3,"showBackBtn","isClinician","title"],[3,"stateModel","hasNoData","noDataMessage","loadingMessage","failedMessage"],[1,"content"],["class","flex_list list_item",3,"id","ngClass","click",4,"ngFor","ngForOf"],["id","footer","class","flex-column",4,"ngIf"],[1,"flex_list","list_item",3,"id","ngClass","click"],[1,"questionnaire_list_item_container"],[1,"questionnaire_list_item"],["class","schedule_window_indicator",4,"ngIf"],[1,"schedule_window_indicator"],["id","footer",1,"flex-column"],["id","other-questionnaires",1,"footer-button","right-button",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"header-menu",1)(2,"loading-state",2),e.TgZ(3,"nav",3),e.YNc(4,fn,5,8,"a",4),e.qZA(),e.YNc(5,_n,4,3,"div",5),e.qZA()),2&t&&(e.xp6(1),e.Q6J("showBackBtn",!0)("isClinician",o.isClinician)("title","PERFORM_MEASUREMENTS"),e.xp6(1),e.Q6J("stateModel",o.model.state)("hasNoData",0===o.model.questionnaires.length)("noDataMessage","QUESTIONNAIRES_NO_QUESTIONNAIRES")("loadingMessage","QUESTIONNAIRES_LOADING")("failedMessage","QUESTIONNAIRES_FAILED"),e.xp6(2),e.Q6J("ngForOf",o.model.questionnaires),e.xp6(1),e.Q6J("ngIf",o.isClinician))},dependencies:[I.mk,I.sg,I.O5,X.G,Ae.X,M.X$]}),n})();function En(n,r){1&n&&(e.TgZ(0,"div")(1,"h2",14),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"END_QUESTION_TEXT")))}function Nn(n,r){1&n&&(e.TgZ(0,"div",15)(1,"h2"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"UPLOADING_WAIT_TEXT")))}function Tn(n,r){1&n&&(e.TgZ(0,"div",16)(1,"h2",17),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"SEND_REPLIES_ACK_TEXT")," "))}function vn(n,r){1&n&&(e.TgZ(0,"div",18)(1,"h2",19),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"UPLOAD_FAILED_TEXT")," "))}function In(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.skipSendClick())}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",21),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NO")," "))}function On(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.sendClick())}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",23),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"YES")," "))}function Cn(n,r){1&n&&(e.TgZ(0,"button",24),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",23),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"OK")," "))}function Mn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.ackOkClick())}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",23),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"OK")," "))}function An(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancelRetryClick())}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",21),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"CANCEL")," "))}function Sn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.sendClick())}),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",23),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"RETRY")," "))}let Un=(()=>{class n{constructor(t,o,i,s){this.appContext=t,this.questionnaires=o,this.native=i,this.router=s,this.sendReplyState=P,this.model={title:"SEND_REPLIES_TITLE",state:P.CONFIRM},this.skipSendClick=()=>{this.router.navigate(["/menu"])},this.extractQuestionnaireId=l=>{const d=l.split("/").reverse().find(m=>!isNaN(Number(m)));return Number(d)},this.sendClick=()=>{this.model.title="UPLOADING_REPLIES_TEXT",this.model.state=P.UPLOADING,this.questionnaires.replyTo(this.questionnaireState.questionnaire,this.questionnaireState.outputs).then(()=>{this.model.title="SEND_REPLIES_TITLE",this.model.state=P.ACKNOWLEDGE;const l=this.extractQuestionnaireId(this.questionnaireState.questionnaire.links.questionnaireResult);this.native.clearScheduledQuestionnaire(l)||console.debug("Couldn't deliver clear schedules request due to missing native layer")},()=>{this.model.title="ERROR_TITLE",this.model.state=P.FAILED}).catch(()=>{this.model.title="ERROR_TITLE",this.model.state=P.FAILED})},this.ackOkClick=()=>{this.router.navigate(["/menu"])},this.cancelRetryClick=()=>{this.router.navigate(["/menu"])},this.goBack=()=>{this.appContext.requestParams.set(xn,this.questionnaireState.questionnaireRef),this.appContext.requestParams.set(Ee,this.questionnaireState),globalThis.history.back()},this.appContext.requestParams.containsKey(Ee)?this.questionnaireState=this.appContext.requestParams.getAndClear(Ee):this.router.navigate(["/menu"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(K.P),e.Y36(ie),e.Y36($.R),e.Y36(w.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-send-reply"]],decls:15,vars:13,consts:[[1,"container"],[3,"showBackBtn","showHomeBtn","title"],[1,"content"],[4,"ngIf"],["class","send-reply-uploading",4,"ngIf"],["class","send-reply-uploaded",4,"ngIf"],["class","send-reply-failed",4,"ngIf"],["id","footer",1,"flex-column"],["id","question-left-button","class","footer-button left-button",3,"click",4,"ngIf"],["id","question-right-button","class","footer-button right-button",3,"click",4,"ngIf"],["id","question-center-button","class","footer-button center-button","disabled","disabled",4,"ngIf"],["id","question-center-button","class","footer-button center-button",3,"click",4,"ngIf"],["id","cancel-retry-button","class","footer-button left-button",3,"click",4,"ngIf"],["id","retry-button","class","footer-button right-button",3,"click",4,"ngIf"],["id","send-reply-text"],[1,"send-reply-uploading"],[1,"send-reply-uploaded"],["id","send-reply-ack-text"],[1,"send-reply-failed"],["id","send-reply-failed-text",1,"text-center","error-message"],["id","question-left-button",1,"footer-button","left-button",3,"click"],["aria-hidden","true",1,"icon","fas","fa-times-circle"],["id","question-right-button",1,"footer-button","right-button",3,"click"],["aria-hidden","true",1,"icon","fas","fa-check-circle"],["id","question-center-button","disabled","disabled",1,"footer-button","center-button"],["id","question-center-button",1,"footer-button","center-button",3,"click"],["id","cancel-retry-button",1,"footer-button","left-button",3,"click"],["id","retry-button",1,"footer-button","right-button",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"header-menu",1),e.TgZ(2,"div",2)(3,"div"),e.YNc(4,En,4,3,"div",3),e.YNc(5,Nn,4,3,"div",4),e.YNc(6,Tn,4,3,"div",5),e.YNc(7,vn,4,3,"div",6),e.qZA()(),e.TgZ(8,"div",7),e.YNc(9,In,4,3,"button",8),e.YNc(10,On,4,3,"button",9),e.YNc(11,Cn,4,3,"button",10),e.YNc(12,Mn,4,3,"button",11),e.YNc(13,An,4,3,"button",12),e.YNc(14,Sn,4,3,"button",13),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("showBackBtn",!0)("showHomeBtn",!0)("title",o.model.title),e.xp6(3),e.Q6J("ngIf",o.model.state===o.sendReplyState.CONFIRM),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.UPLOADING),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.ACKNOWLEDGE),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.FAILED),e.xp6(2),e.Q6J("ngIf",o.model.state===o.sendReplyState.CONFIRM),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.CONFIRM),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.UPLOADING),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.ACKNOWLEDGE),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.FAILED),e.xp6(1),e.Q6J("ngIf",o.model.state===o.sendReplyState.FAILED))},dependencies:[I.O5,X.G,M.X$]}),n})();const Ee="questionnaireState",xn="selectedQuestionnaire";var P=(()=>{return(n=P||(P={}))[n.CONFIRM=0]="CONFIRM",n[n.UPLOADING=1]="UPLOADING",n[n.ACKNOWLEDGE=2]="ACKNOWLEDGE",n[n.FAILED=3]="FAILED",P;var n})();const yn=[{path:"",component:gn},{path:":id/questionnaire",component:un},{path:":id/send_reply",component:Un},{path:"other_questionnaires",component:Je,canActivate:[ce.N]}];let Dn=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[w.Bz.forChild(yn),w.Bz]}),n})();var Ue=O(4546),xe=O(4466),Rn=O(9017),ye=O(1231);let Ln=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[I.ez,a.UX,xe.m,Ue.O,ye.F]}),n})(),bn=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[I.ez,Dn,Ue.O,xe.m,a.u5,a.UX,Rn.I,ye.F,Ln,Ne.ZQ]}),n})()},1480:(Le,oe,O)=>{O.d(oe,{E:()=>I});const I=(w,Y)=>w+Y}}]);