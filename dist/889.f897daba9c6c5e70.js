"use strict";(self.webpackChunkopentele_client_html_angular=self.webpackChunkopentele_client_html_angular||[]).push([[889],{5889:(L,I,o)=>{o.r(I),o.d(I,{ConferenceModule:()=>C});var e=o(60),E=o(619),t=o(5e3),_=o(7362),g=o(4338),m=o(1866),T=o(7166),N=o(8507),F=o(1786);function x(i,u){if(1&i&&(t.TgZ(0,"div")(1,"h2"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"h3"),t._uU(5),t.ALo(6,"translate"),t.qZA()()),2&i){const c=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,c.model.header)),t.xp6(3),t.Oqu(t.lcZ(6,4,c.model.message))}}function A(i,u){if(1&i){const c=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(c);const S=t.oxw();return t.KtG(S.acceptCall())}),t._uU(2),t.ALo(3,"translate"),t.qZA()()}if(2&i){const c=t.oxw();t.xp6(1),t.Q6J("disabled",c.model.state===c.states.JOINING),t.xp6(1),t.hij(" ",t.lcZ(3,2,c.texts.joinButton)," ")}}const d="individualSessionUrl";var p=(()=>{return(i=p||(p={})).PROMPTED="prompted",i.JOINING="joining",i.JOINED="joined",i.DISCONNECTED="disconnected",p;var i})();const a=Object.freeze({header:"CONFERENCE_JOIN_HEADER",joining:"CONFERENCE_JOINING_MESSAGE",join:"CONFERENCE_JOIN_MESSAGE",joinButton:"CONFERENCE_JOIN_BUTTON"}),n=[{path:"",component:(()=>{class i{constructor(c,h,S,O){this.native=c,this.appContext=h,this.videoFacade=S,this.idle=O,this.states=p,this.texts=a,this.model={header:a.header,message:a.join,state:p.PROMPTED}}ngOnInit(){this.checkHostIsPresent(),this.native.playNotificationSound()||console.debug("Couldn't play notification sound due to missing native layer")}acceptCall(){this.native.stopNotificationSound()||console.debug("Couldn't stop notification sound due to missing native layer"),this.idle.stop(),this.model.message=a.joining,this.model.state=p.JOINING;const h=this.appContext.requestParams,S=h.getAndClear("roomCredentials"),O=h.getAndClear(d),P=Object.freeze({isOneOnOne:!0,videoType:"vidyo",parameters:S});this.videoFacade.listenForNativeEvent(O,this.model),this.native.joinConference(P)||console.debug("Couldn't join conference due to missing native layer")}checkHostIsPresent(){console.debug("Check if host is still present");const h=this.appContext.requestParams.get(d);let S=0;const O=()=>{this.videoFacade.isHostPresent(h).then(R=>{const M=null==R?void 0:R.host;0==(null==M?void 0:M.present)?(console.debug("Host not present, ending conference"),this.native.stopNotificationSound()||console.debug("Couldn't stop notification sound due to missing native layer"),this.model.state=p.DISCONNECTED,this.videoFacade.sessionEnded(h)):this.model.state===p.DISCONNECTED?console.debug("Meeting stopped by other source, will stop checking if host is present"):setTimeout(()=>{O()},7e3)}).catch(()=>{console.debug("Failed to check if host is still present, status: response.status"),S>=3?(console.debug("Maximum number of retries reached, ending conference"),this.native.stopNotificationSound()||console.debug("Couldn't stop notification sound due to missing native layer"),this.videoFacade.sessionEnded(h)):(console.debug("Retrying 'check if host is still present'"),S+=1,setTimeout(()=>{O()},7e3))})};O()}}return i.\u0275fac=function(c){return new(c||i)(t.Y36(_.R),t.Y36(g.P),t.Y36(m.k),t.Y36(T.hX))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-join-conference"]],decls:5,vars:3,consts:[[1,"container"],[3,"title"],[1,"content"],[4,"ngIf"],["id","footer","class","flex-column",4,"ngIf"],["id","footer",1,"flex-column"],["id","join-button",1,"footer-button","center-button",3,"disabled","click"]],template:function(c,h){1&c&&(t.TgZ(0,"div",0),t._UZ(1,"header-menu",1),t.TgZ(2,"div",2),t.YNc(3,x,7,6,"div",3),t.qZA(),t.YNc(4,A,4,4,"div",4),t.qZA()),2&c&&(t.xp6(1),t.Q6J("title","CONFERENCE_TITLE"),t.xp6(2),t.Q6J("ngIf",h.model.state===h.states.PROMPTED||h.model.state===h.states.JOINING),t.xp6(1),t.Q6J("ngIf",h.model.state!==h.states.JOINED))},dependencies:[e.O5,N.G,F.X$]}),i})()}];let r=(()=>{class i{}return i.\u0275fac=function(c){return new(c||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[E.Bz.forChild(n),E.Bz]}),i})();var s=o(4466),f=o(4546);let C=(()=>{class i{}return i.\u0275fac=function(c){return new(c||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[e.ez,r,s.m,f.O]}),i})()},4546:(L,I,o)=>{o.d(I,{O:()=>_});var e=o(60),E=o(4466),t=o(5e3);let _=(()=>{class g{}return g.\u0275fac=function(T){return new(T||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[e.ez,E.m]}),g})()},8507:(L,I,o)=>{o.d(I,{G:()=>p});var e=o(5e3),E=o(619),t=o(1786),_=o(7362),g=o(4338),m=o(8351),T=o(4879),N=o(60);const F=function(a){return{clickable:a}};function x(a,l){if(1&a){const n=e.EpF();e.TgZ(0,"div",2)(1,"img",3),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.clickLogo())}),e.ALo(2,"translate"),e.qZA()()}if(2&a){const n=e.oxw();e.xp6(1),e.s9C("alt",e.lcZ(2,2,"LOGO_ARIA")),e.Q6J("ngClass",e.VKq(4,F,n.canClickLogo()))}}function A(a,l){if(1&a){const n=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.goBack())}),e._UZ(1,"i",14),e.qZA()}}function y(a,l){if(1&a){const n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.goChangePassword())}),e._UZ(1,"i",16),e.qZA()}}function d(a,l){if(1&a){const n=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.goHome())}),e._UZ(1,"i",18),e.qZA()}}function b(a,l){if(1&a){const n=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.goLogout())}),e._UZ(1,"i",20),e.qZA()}}function v(a,l){if(1&a&&(e.TgZ(0,"nav",4)(1,"div",5),e.YNc(2,A,2,0,"button",6),e.YNc(3,y,2,0,"button",7),e.qZA(),e.TgZ(4,"div",8),e._UZ(5,"h1",9),e.qZA(),e.TgZ(6,"div",10),e.YNc(7,d,2,0,"button",11),e.YNc(8,b,2,0,"button",12),e.qZA()()),2&a){const n=e.oxw();e.xp6(2),e.Q6J("ngIf",n.showBackBtn),e.xp6(1),e.Q6J("ngIf",n.showChangePasswordBtn),e.xp6(2),e.Q6J("innerHtml",n.title,e.oJD),e.xp6(2),e.Q6J("ngIf",n.showHomeBtn),e.xp6(1),e.Q6J("ngIf",n.showLogoutBtn)}}let p=(()=>{class a{constructor(n,r,s,f,C,i,u){this.applicationRef=n,this.router=r,this.translate=s,this.native=f,this.appContext=C,this.config=i,this.authentication=u,this.showBackBtn=!1,this.showHomeBtn=!1,this.onHomeFun=()=>this.router.navigate(["/menu"]),this.isClinician=!1,this.title="",this.showChangePasswordBtn=!1,this.showLogoutBtn=!1,this.showLogo=!1,this.goBack=()=>{this.onBackFun?this.onBackFun():globalThis.history.back()},this.goLogout=()=>{const c=this.translate.instant("LOGOUT_CONFIRM_MSG"),h=this.translate.instant("OK"),S=this.translate.instant("CANCEL");this.native.showConfirmDialog(c,h,S,O=>{O&&(this.router.navigate(["/logout"]),setTimeout(()=>this.applicationRef.tick(),100))})},this.goChangePassword=()=>{this.router.navigate(["/change_password"])}}ngOnChanges(){this.title=this.title?this.translate.instant(this.title):""}canClickLogo(){return!!this.helpAndInfoUrl()}helpAndInfoUrl(){return this.config.getAppConfig().helpAndInfoUrl}clickLogo(){const n=this.helpAndInfoUrl();this.canClickLogo()&&void 0!==n&&this.native.openUrl(n)}goHome(){this.onHomeFun?this.onHomeFun():this.router.navigate(["/menu"])}goClinicianMenu(){this.appContext.requestParams.getAndClear("selectedPatient"),this.router.navigate(["/clinician_menu"])}}return a.\u0275fac=function(n){return new(n||a)(e.Y36(e.z2F),e.Y36(E.F0),e.Y36(t.sK),e.Y36(_.R),e.Y36(g.P),e.Y36(m.E),e.Y36(T.$))},a.\u0275cmp=e.Xpm({type:a,selectors:[["header-menu"]],inputs:{showBackBtn:"showBackBtn",onBackFun:"onBackFun",showHomeBtn:"showHomeBtn",onHomeFun:"onHomeFun",isClinician:"isClinician",title:"title",showChangePasswordBtn:"showChangePasswordBtn",showLogoutBtn:"showLogoutBtn",showLogo:"showLogo"},features:[e.TTD],decls:2,vars:2,consts:[["id","logo",4,"ngIf"],["id","header",4,"ngIf"],["id","logo"],["src","./assets/product-flavor/images/header.svg",3,"alt","ngClass","click"],["id","header"],[1,"header-left"],["id","back-button","type","button","class","button",3,"click",4,"ngIf"],["id","change-password-button","type","button","class","button",3,"click",4,"ngIf"],[1,"header-center"],["id","header-title",3,"innerHtml"],[1,"header-right"],["id","menu-button","type","button","class","button",3,"click",4,"ngIf"],["id","logout-button","type","button","class","button",3,"click",4,"ngIf"],["id","back-button","type","button",1,"button",3,"click"],["aria-hidden","true",1,"fal","fa-arrow-left"],["id","change-password-button","type","button",1,"button",3,"click"],["aria-hidden","true",1,"fal","fa-user-lock"],["id","menu-button","type","button",1,"button",3,"click"],["aria-hidden","true",1,"fal","fa-home"],["id","logout-button","type","button",1,"button",3,"click"],["aria-hidden","true",1,"fal","fa-sign-out"]],template:function(n,r){1&n&&(e.YNc(0,x,3,6,"div",0),e.YNc(1,v,9,5,"nav",1)),2&n&&(e.Q6J("ngIf",r.showLogo),e.xp6(1),e.Q6J("ngIf",!r.showLogo))},dependencies:[N.mk,N.O5,t.X$]}),a})()},1866:(L,I,o)=>{o.d(I,{k:()=>y});var e=o(5e3),E=o(5861),t=o(60),_=o(520),g=o(9808),m=o(2826),T=o(4338),N=o(619);let F=(()=>{class d{constructor(v,p,a,l){var n=this;this.http=v,this.appContext=p,this.router=a,this.ngZone=l,this.constants=Object.freeze({roomCredentials:"roomCredentials",sessionUrl:"individualSessionUrl",joinConferencePath:"joinConference",loginPath:"login",authenticationError:"authenticationError"}),this.joinSession=function(){var r=(0,E.Z)(function*(s){const f=(new _.qT).set(m.SF,!0).set(m.Hq,!0);console.debug("Joining conference"),console.debug("Individual session:",JSON.stringify(s));const C=s.links.individualSession,i=t.Ye.joinWithSlash(C,"participant");try{const u={present:!0},c=yield(0,g.n)(n.http.put(i,u,{context:f}));console.debug("Room status:",JSON.stringify(c)),n.appContext.requestParams.set(n.constants.roomCredentials,c.roomCredentials),n.appContext.requestParams.set(n.constants.sessionUrl,C),n.ngZone.run(()=>{console.debug("Redirecting to join conference component"),n.router.navigate([n.constants.joinConferencePath])})}catch(u){const c=u instanceof _.UA?`Status: ${u.status}`:JSON.stringify(u);console.error("Could not join session %s. %s",s,c)}});return function(s){return r.apply(this,arguments)}}(),this.leaveSession=function(){var r=(0,E.Z)(function*(s){console.debug("Leaving individual session");const f=(new _.qT).set(m.SF,!0).set(m.Hq,!0);console.debug(`Individual sessions URL: ${s}`);const C=t.Ye.joinWithSlash(s,"participant"),i={present:!1};try{yield(0,g.n)(n.http.put(C,i,{context:f})),console.debug("Succesfully left individual session")}catch(u){console.debug("Failed to leave individual session"),console.debug(`Status: ${u}`)}});return function(s){return r.apply(this,arguments)}}(),this.checkForSession=function(){var r=(0,E.Z)(function*(s){const f=new URL(s);f.searchParams.set("status","open");const C=(new _.qT).set(m.SF,!0).set(m.Hq,!0);try{return(0,g.n)(n.http.get(f.toString(),{context:C}))}catch(i){return console.error(`Error occurred trying to check for pending individual sessions: ${i}`),Promise.resolve(void 0)}});return function(s){return r.apply(this,arguments)}}(),this.checkForSessionAndJoin=function(){var r=(0,E.Z)(function*(s){const f=yield n.checkForSession(s);void 0!==f&&f.results.length>0&&n.joinSession(f.results[0])});return function(s){return r.apply(this,arguments)}}(),this.isHostPresent=r=>{const s=(new _.qT).set(m.SF,!0).set(m.Hq,!0);return(0,g.n)(this.http.get(r,{context:s}))}}}return d.\u0275fac=function(v){return new(v||d)(e.LFG(_.eN),e.LFG(T.P),e.LFG(N.F0),e.LFG(e.R0b))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})();var x=o(7362);let A=(()=>{class d{constructor(v,p,a){this.native=v,this.individualSessionsApi=p,this.router=a,this.texts=Object.freeze({conferenceStarted:"CONFERENCE_STARTED",conferenceEnded:"CONFERENCE_ENDED",conferenceError:"CONFERENCE_ERROR"}),this.constants=Object.freeze({status:"status",info:"info",error:"error",timeoutInMillis:3e3,menuPath:"/menu",videoConferenceResponse:"videoConferenceResponse",incomingVideoCall:"incomingVideoCall"}),this.states=Object.freeze({prompted:"prompted",joining:"joining",joined:"joined",disconnected:"disconnected"}),this.listenForNativeEvent=(l,n)=>{this.native.subscribeToMultipleMessages(this.constants.videoConferenceResponse,s=>{this.handleEvent(l,n,s.event)})},this.listenForIncomingCall=l=>{this.native.unsubscribeAll(this.constants.incomingVideoCall),this.native.subscribeToMultipleMessages(this.constants.incomingVideoCall,()=>{console.debug("received 'incomingVideoCall' message"),this.individualSessionsApi.checkForSessionAndJoin(l)})},this.handleEvent=(l,n,r)=>{console.debug(`Event: ${JSON.stringify(r)}`);const s=r.type;s===this.constants.status?this.handleStatusEvent(l,n,r):console.warn(`Unknown event type: ${s}`)},this.handleStatusEvent=(l,n,r)=>{const s=r.status,f=s.type,C=s.message;switch(f){case this.constants.error:this.handleErrorEvent(l,n,C);break;case this.constants.info:this.handleInfoEvent(l,n,C);break;default:console.warn(`Unknown status type: ${f}`)}},this.handleErrorEvent=(l,n,r)=>{n.state=this.states.disconnected,r===this.texts.conferenceError?this.endSession(l):n.error=r},this.handleInfoEvent=(l,n,r)=>{switch(n.message=r,r){case this.texts.conferenceStarted:console.debug("Conference started"),n.state=this.states.joined;break;case this.texts.conferenceEnded:n.state=this.states.disconnected,this.endSession(l);break;default:console.debug(`Info message received: ${JSON.stringify(r)}`),n.info=r}},this.endSession=l=>{console.debug("CONFERENCE ENDED"),this.individualSessionsApi.leaveSession(l),this.native.leaveConference()||console.debug("Couldn't leave conference"),this.native.unsubscribeAll(this.constants.videoConferenceResponse),this.router.navigate([this.constants.menuPath])}}}return d.\u0275fac=function(v){return new(v||d)(e.LFG(x.R),e.LFG(F),e.LFG(N.F0))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),y=(()=>{class d{constructor(v,p){this.individualSessionsApi=v,this.videoListener=p,this.checkForSessionAndJoin=this.individualSessionsApi.checkForSessionAndJoin,this.leaveSession=this.individualSessionsApi.leaveSession,this.isHostPresent=this.individualSessionsApi.isHostPresent,this.sessionEnded=this.videoListener.endSession,this.listenForNativeEvent=this.videoListener.listenForNativeEvent,this.listenForIncomingCall=this.videoListener.listenForIncomingCall}}return d.\u0275fac=function(v){return new(v||d)(e.LFG(F),e.LFG(A))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()}}]);