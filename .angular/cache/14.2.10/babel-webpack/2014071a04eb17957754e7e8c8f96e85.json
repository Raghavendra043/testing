{"ast":null,"code":"import { NgForm } from \"@angular/forms\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/state-services/state-passing.service\";\nimport * as i2 from \"src/app/services/rest-api-services/authentication.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"../../header/header/header.component\";\nimport * as i7 from \"@ngx-translate/core\";\nfunction ChangePasswordComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6);\n    i0.ɵɵelement(1, \"i\", 7);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 1, ctx_r0.model.error), \" \");\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    padding_when_notification: a0\n  };\n};\nfunction ChangePasswordComponent_form_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 8, 9);\n    i0.ɵɵlistener(\"ngSubmit\", function ChangePasswordComponent_form_5_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.submit());\n    });\n    i0.ɵɵelementStart(2, \"div\", 10)(3, \"div\", 11);\n    i0.ɵɵelement(4, \"i\", 12);\n    i0.ɵɵelementStart(5, \"input\", 13, 14);\n    i0.ɵɵlistener(\"ngModelChange\", function ChangePasswordComponent_form_5_Template_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.model.currentPassword = $event);\n    });\n    i0.ɵɵpipe(7, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 11);\n    i0.ɵɵelement(9, \"i\", 15);\n    i0.ɵɵelementStart(10, \"input\", 16, 17);\n    i0.ɵɵlistener(\"ngModelChange\", function ChangePasswordComponent_form_5_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.model.password = $event);\n    });\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"div\", 11);\n    i0.ɵɵelement(14, \"i\", 18);\n    i0.ɵɵelementStart(15, \"input\", 19, 20);\n    i0.ɵɵlistener(\"ngModelChange\", function ChangePasswordComponent_form_5_Template_input_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.model.passwordRepeat = $event);\n    });\n    i0.ɵɵpipe(17, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\", 21)(19, \"button\", 22);\n    i0.ɵɵtext(20);\n    i0.ɵɵpipe(21, \"translate\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const _r2 = i0.ɵɵreference(1);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(17, _c0, ctx_r1.model.error));\n    i0.ɵɵadvance(5);\n    i0.ɵɵpropertyInterpolate(\"placeholder\", i0.ɵɵpipeBind1(7, 9, \"CHANGE_PASSWORD_FORM_CURRENT\"));\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.model.currentPassword);\n    i0.ɵɵadvance(5);\n    i0.ɵɵpropertyInterpolate(\"placeholder\", i0.ɵɵpipeBind1(12, 11, \"CHANGE_PASSWORD_FORM_NEW\"));\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.model.password);\n    i0.ɵɵadvance(5);\n    i0.ɵɵpropertyInterpolate(\"placeholder\", i0.ɵɵpipeBind1(17, 13, \"CHANGE_PASSWORD_FORM_REPEAT\"));\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.model.passwordRepeat);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"disabled\", !_r2.form.valid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(21, 15, \"CHANGE_PASSWORD_FORM_CHANGE_BUTTON\"), \" \");\n  }\n}\nexport let ChangePasswordComponent = /*#__PURE__*/(() => {\n  class ChangePasswordComponent {\n    constructor(appContext, authentication, router) {\n      this.appContext = appContext;\n      this.authentication = authentication;\n      this.router = router;\n      this.model = {\n        showProgress: false\n      };\n      this.tryChangePassword = () => {\n        if (this.model.currentPassword == this.model.password) {\n          this.model.error = \"CHANGE_PASSWORD_UNIQUE\";\n          return;\n        }\n        this.model.showProgress = true;\n        const onSuccess = () => {\n          this.model.showProgress = false;\n          this.router.navigate([\"login\"]);\n        };\n        const onError = response => {\n          var _a;\n          const data = response.data;\n          const status = response.status;\n          this.model.showProgress = false;\n          switch (status) {\n            case 400:\n              {\n                const errorCode = (_a = data.errors) === null || _a === void 0 ? void 0 : _a[0].error.toUpperCase();\n                this.model.error = `CHANGE_PASSWORD_${errorCode}`;\n                break;\n              }\n            case 401:\n              this.model.error = \"BAD_CREDENTIALS\";\n              break;\n            default:\n              this.model.error = \"OPENTELE_DOWN_TEXT\";\n          }\n        };\n        const user = this.appContext.currentUser.get();\n        const userInfo = this.appContext.requestParams.get(\"userInfo\");\n        this.authentication.changePassword((user === null || user === void 0 ? void 0 : user.username) || userInfo.username, (user === null || user === void 0 ? void 0 : user.links.changePassword) || userInfo.changePasswordUrl, this.model.currentPassword, this.model.password).subscribe({\n          next: onSuccess,\n          error: onError\n        });\n      };\n    }\n    ngOnInit() {\n      if (this.appContext.requestParams.containsKey(\"forceChange\") && this.appContext.requestParams.getAndClear(\"forceChange\") === true) {\n        this.model.forceChange = true;\n        this.model.error = \"CHANGE_PASSWORD_EXPIRED\";\n      } else {\n        this.model.forceChange = false;\n      }\n    }\n    changeIfValid() {\n      if (this.model.password !== this.model.passwordRepeat) {\n        this.model.error = \"CHANGE_PASSWORD_FORM_ERROR_MATCH\";\n      } else {\n        this.tryChangePassword();\n      }\n    }\n    submit() {\n      delete this.model.error;\n      this.changeIfValid();\n    }\n  }\n  ChangePasswordComponent.ɵfac = function ChangePasswordComponent_Factory(t) {\n    return new (t || ChangePasswordComponent)(i0.ɵɵdirectiveInject(i1.StatePassingService), i0.ɵɵdirectiveInject(i2.AuthenticationService), i0.ɵɵdirectiveInject(i3.Router));\n  };\n  ChangePasswordComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChangePasswordComponent,\n    selectors: [[\"app-change-password\"]],\n    viewQuery: function ChangePasswordComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(NgForm, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.ngForm = _t.first);\n      }\n    },\n    decls: 6,\n    vars: 4,\n    consts: [[1, \"container\"], [3, \"title\", \"showBackBtn\"], [1, \"content\"], [\"class\", \"notification error\", 4, \"ngIf\"], [1, \"fill\"], [\"id\", \"change-password-form\", \"class\", \"login_form\", \"autocomplete\", \"off\", \"spellcheck\", \"false\", \"autocapitalize\", \"off\", 3, \"ngClass\", \"ngSubmit\", 4, \"ngIf\"], [1, \"notification\", \"error\"], [1, \"notification_icon\", \"fas\", \"fa-exclamation-triangle\"], [\"id\", \"change-password-form\", \"autocomplete\", \"off\", \"spellcheck\", \"false\", \"autocapitalize\", \"off\", 1, \"login_form\", 3, \"ngClass\", \"ngSubmit\"], [\"changePasswordForm\", \"ngForm\"], [\"id\", \"input-container\"], [1, \"login_input\"], [1, \"fal\", \"fa-lock-open-alt\"], [\"id\", \"current-password\", \"required\", \"\", \"autofocus\", \"\", \"name\", \"currentPassword\", \"type\", \"text\", \"size\", \"13\", \"autocomplete\", \"off\", \"spellcheck\", \"false\", \"autocapitalize\", \"off\", 1, \"password\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\"], [\"currentPassword\", \"ngModel\"], [1, \"fal\", \"fa-unlock-alt\"], [\"id\", \"new-password\", \"required\", \"\", \"autofocus\", \"true\", \"name\", \"password\", \"type\", \"text\", \"size\", \"13\", \"autocomplete\", \"off\", \"autocorrect\", \"off\", \"autocapitalize\", \"off\", 1, \"password\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\"], [\"password\", \"ngModel\"], [1, \"fal\", \"fa-lock-alt\"], [\"id\", \"new-password-repeat\", \"required\", \"\", \"name\", \"passwordRepeat\", \"type\", \"text\", \"size\", \"13\", \"autocomplete\", \"off\", \"autocorrect\", \"off\", \"autocapitalize\", \"off\", 1, \"password\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\"], [\"passwordRepeat\", \"ngModel\"], [1, \"button_container\"], [\"id\", \"submit\", \"type\", \"submit\", 1, \"button\", 3, \"disabled\"]],\n    template: function ChangePasswordComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"header-menu\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵtemplate(3, ChangePasswordComponent_div_3_Template, 4, 3, \"div\", 3);\n        i0.ɵɵelementStart(4, \"div\", 4);\n        i0.ɵɵtemplate(5, ChangePasswordComponent_form_5_Template, 22, 19, \"form\", 5);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"title\", \"CHANGE_PASSWORD_TITLE\")(\"showBackBtn\", true);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.error);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.model.showProgress);\n      }\n    },\n    dependencies: [i4.NgClass, i4.NgIf, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.RequiredValidator, i5.NgModel, i5.NgForm, i6.HeaderComponent, i7.TranslatePipe]\n  });\n  return ChangePasswordComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}