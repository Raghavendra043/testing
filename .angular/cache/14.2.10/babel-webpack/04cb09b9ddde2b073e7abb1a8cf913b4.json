{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/state-services/state-passing.service\";\nimport * as i2 from \"src/app/services/rest-api-services/questionnaires.service\";\nimport * as i3 from \"src/app/services/native-services/native.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../header/header/header.component\";\nimport * as i7 from \"@ngx-translate/core\";\nfunction SendReplyComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h2\", 14);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 1, \"END_QUESTION_TEXT\"));\n  }\n}\nfunction SendReplyComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 1, \"UPLOADING_WAIT_TEXT\"));\n  }\n}\nfunction SendReplyComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"h2\", 17);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 1, \"SEND_REPLIES_ACK_TEXT\"), \" \");\n  }\n}\nfunction SendReplyComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"h2\", 19);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 1, \"UPLOAD_FAILED_TEXT\"), \" \");\n  }\n}\nfunction SendReplyComponent_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function SendReplyComponent_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.skipSendClick());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"i\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"NO\"), \" \");\n  }\n}\nfunction SendReplyComponent_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function SendReplyComponent_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.sendClick());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"i\", 23);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"YES\"), \" \");\n  }\n}\nfunction SendReplyComponent_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"i\", 23);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"OK\"), \" \");\n  }\n}\nfunction SendReplyComponent_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function SendReplyComponent_button_12_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.ackOkClick());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"i\", 23);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"OK\"), \" \");\n  }\n}\nfunction SendReplyComponent_button_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function SendReplyComponent_button_13_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.cancelRetryClick());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"i\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"CANCEL\"), \" \");\n  }\n}\nfunction SendReplyComponent_button_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 27);\n    i0.ɵɵlistener(\"click\", function SendReplyComponent_button_14_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.sendClick());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"i\", 23);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"RETRY\"), \" \");\n  }\n}\nexport let SendReplyComponent = /*#__PURE__*/(() => {\n  class SendReplyComponent {\n    constructor(appContext, questionnaires, native, router) {\n      this.appContext = appContext;\n      this.questionnaires = questionnaires;\n      this.native = native;\n      this.router = router;\n      this.sendReplyState = SendReplyState; // expose enum to template\n      this.model = {\n        title: 'SEND_REPLIES_TITLE',\n        state: SendReplyState.CONFIRM\n      };\n      this.skipSendClick = () => {\n        this.router.navigate(['/menu']);\n      };\n      this.extractQuestionnaireId = url => {\n        const segments = url.split('/').reverse();\n        const idPart = segments.find(e => !isNaN(Number(e)));\n        return Number(idPart);\n      };\n      this.sendClick = () => {\n        this.model.title = 'UPLOADING_REPLIES_TEXT';\n        this.model.state = SendReplyState.UPLOADING;\n        this.questionnaires.replyTo(this.questionnaireState.questionnaire, this.questionnaireState.outputs).then(() => {\n          this.model.title = 'SEND_REPLIES_TITLE';\n          this.model.state = SendReplyState.ACKNOWLEDGE;\n          const questionnaireId = this.extractQuestionnaireId(this.questionnaireState.questionnaire.links.questionnaireResult);\n          const clearSchedulesRequestDelivered = this.native.clearScheduledQuestionnaire(questionnaireId);\n          if (!clearSchedulesRequestDelivered) {\n            console.debug(\"Couldn't deliver clear schedules request due to missing native layer\");\n          }\n        }, () => {\n          this.model.title = 'ERROR_TITLE';\n          this.model.state = SendReplyState.FAILED;\n        }).catch(() => {\n          this.model.title = 'ERROR_TITLE';\n          this.model.state = SendReplyState.FAILED;\n        });\n      };\n      this.ackOkClick = () => {\n        this.router.navigate(['/menu']);\n      };\n      this.cancelRetryClick = () => {\n        this.router.navigate(['/menu']);\n      };\n      this.goBack = () => {\n        this.appContext.requestParams.set(SELECTED_QUESTIONNAIRE, this.questionnaireState.questionnaireRef);\n        this.appContext.requestParams.set(QUESTIONNAIRE_STATE, this.questionnaireState);\n        globalThis.history.back();\n      };\n      if (!this.appContext.requestParams.containsKey(QUESTIONNAIRE_STATE)) {\n        this.router.navigate(['/menu']);\n        return;\n      }\n      this.questionnaireState = this.appContext.requestParams.getAndClear(QUESTIONNAIRE_STATE);\n    }\n  }\n  SendReplyComponent.ɵfac = function SendReplyComponent_Factory(t) {\n    return new (t || SendReplyComponent)(i0.ɵɵdirectiveInject(i1.StatePassingService), i0.ɵɵdirectiveInject(i2.QuestionnairesService), i0.ɵɵdirectiveInject(i3.NativeService), i0.ɵɵdirectiveInject(i4.Router));\n  };\n  SendReplyComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SendReplyComponent,\n    selectors: [[\"app-send-reply\"]],\n    decls: 15,\n    vars: 13,\n    consts: [[1, \"container\"], [3, \"showBackBtn\", \"showHomeBtn\", \"title\"], [1, \"content\"], [4, \"ngIf\"], [\"class\", \"send-reply-uploading\", 4, \"ngIf\"], [\"class\", \"send-reply-uploaded\", 4, \"ngIf\"], [\"class\", \"send-reply-failed\", 4, \"ngIf\"], [\"id\", \"footer\", 1, \"flex-column\"], [\"id\", \"question-left-button\", \"class\", \"footer-button left-button\", 3, \"click\", 4, \"ngIf\"], [\"id\", \"question-right-button\", \"class\", \"footer-button right-button\", 3, \"click\", 4, \"ngIf\"], [\"id\", \"question-center-button\", \"class\", \"footer-button center-button\", \"disabled\", \"disabled\", 4, \"ngIf\"], [\"id\", \"question-center-button\", \"class\", \"footer-button center-button\", 3, \"click\", 4, \"ngIf\"], [\"id\", \"cancel-retry-button\", \"class\", \"footer-button left-button\", 3, \"click\", 4, \"ngIf\"], [\"id\", \"retry-button\", \"class\", \"footer-button right-button\", 3, \"click\", 4, \"ngIf\"], [\"id\", \"send-reply-text\"], [1, \"send-reply-uploading\"], [1, \"send-reply-uploaded\"], [\"id\", \"send-reply-ack-text\"], [1, \"send-reply-failed\"], [\"id\", \"send-reply-failed-text\", 1, \"text-center\", \"error-message\"], [\"id\", \"question-left-button\", 1, \"footer-button\", \"left-button\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"icon\", \"fas\", \"fa-times-circle\"], [\"id\", \"question-right-button\", 1, \"footer-button\", \"right-button\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"icon\", \"fas\", \"fa-check-circle\"], [\"id\", \"question-center-button\", \"disabled\", \"disabled\", 1, \"footer-button\", \"center-button\"], [\"id\", \"question-center-button\", 1, \"footer-button\", \"center-button\", 3, \"click\"], [\"id\", \"cancel-retry-button\", 1, \"footer-button\", \"left-button\", 3, \"click\"], [\"id\", \"retry-button\", 1, \"footer-button\", \"right-button\", 3, \"click\"]],\n    template: function SendReplyComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"header-menu\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"div\");\n        i0.ɵɵtemplate(4, SendReplyComponent_div_4_Template, 4, 3, \"div\", 3);\n        i0.ɵɵtemplate(5, SendReplyComponent_div_5_Template, 4, 3, \"div\", 4);\n        i0.ɵɵtemplate(6, SendReplyComponent_div_6_Template, 4, 3, \"div\", 5);\n        i0.ɵɵtemplate(7, SendReplyComponent_div_7_Template, 4, 3, \"div\", 6);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"div\", 7);\n        i0.ɵɵtemplate(9, SendReplyComponent_button_9_Template, 4, 3, \"button\", 8);\n        i0.ɵɵtemplate(10, SendReplyComponent_button_10_Template, 4, 3, \"button\", 9);\n        i0.ɵɵtemplate(11, SendReplyComponent_button_11_Template, 4, 3, \"button\", 10);\n        i0.ɵɵtemplate(12, SendReplyComponent_button_12_Template, 4, 3, \"button\", 11);\n        i0.ɵɵtemplate(13, SendReplyComponent_button_13_Template, 4, 3, \"button\", 12);\n        i0.ɵɵtemplate(14, SendReplyComponent_button_14_Template, 4, 3, \"button\", 13);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"showBackBtn\", true)(\"showHomeBtn\", true)(\"title\", ctx.model.title);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.CONFIRM);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.UPLOADING);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.ACKNOWLEDGE);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.FAILED);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.CONFIRM);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.CONFIRM);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.UPLOADING);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.ACKNOWLEDGE);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.FAILED);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.model.state === ctx.sendReplyState.FAILED);\n      }\n    },\n    dependencies: [i5.NgIf, i6.HeaderComponent, i7.TranslatePipe]\n  });\n  return SendReplyComponent;\n})();\nconst QUESTIONNAIRE_STATE = 'questionnaireState';\nconst SELECTED_QUESTIONNAIRE = 'selectedQuestionnaire';\nexport var SendReplyState = /*#__PURE__*/(() => {\n  (function (SendReplyState) {\n    SendReplyState[SendReplyState[\"CONFIRM\"] = 0] = \"CONFIRM\";\n    SendReplyState[SendReplyState[\"UPLOADING\"] = 1] = \"UPLOADING\";\n    SendReplyState[SendReplyState[\"ACKNOWLEDGE\"] = 2] = \"ACKNOWLEDGE\";\n    SendReplyState[SendReplyState[\"FAILED\"] = 3] = \"FAILED\";\n  })(SendReplyState || (SendReplyState = {}));\n  return SendReplyState;\n})();","map":null,"metadata":{},"sourceType":"module"}